# V1 MVP - 设计与架构

**版本**: V1  
**定位**: 股票分析工具 MVP  
**完成时间**: 2024年初

---

## 📋 概述

V1 是 AI 投资报告 Agent 的初始版本，定位为**股票分析工具**，支持多 Agent 协作生成投资报告。

### 核心目标
- 🎯 为用户提供**自动化的股票投资分析报告**
- 🤖 实现**多 Agent 协作**生成报告
- 📊 集成**财务数据和新闻**
- 💬 支持**用户交互**和追问

---

## 🏗️ 系统架构

### 整体架构图

```
┌───────────────────────────────────────────────────────────────┐
│                     Frontend (Vue.js)                          │
│                   简单的聊天界面                                │
└───────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────┐
│            Orchestrator Agent（编排中心）                      │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │  工作流: 接收请求 → 调度 Agent → 收集结果 → 生成报告   │  │
│  └─────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  Market      │    │  Fundamental │    │  Sentiment   │
│  Agent       │    │  Agent       │    │  Agent       │
│  (市场分析)   │    │  (基本面分析) │    │  (情绪分析)   │
└──────────────┘    └──────────────┘    └──────────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              ▼
                    ┌──────────────────┐
                    │  External APIs   │
                    │  - yfinance      │
                    │  - News API      │
                    │  - OpenAI/LLM    │
                    └──────────────────┘
```

---

## 🤖 Agent 设计

### 1. Orchestrator Agent（编排器）

**职责**:
- 接收用户输入（股票代码）
- 协调其他 Agent 的执行
- 收集和整合分析结果
- 生成最终报告

**工作流**:
```python
1. 解析用户请求（股票代码）
2. 并行调用三个分析 Agent
3. 等待所有结果返回
4. 整合为完整报告
5. 返回给前端
```

### 2. Market Agent（市场分析）

**职责**: 分析股票的市场表现

**分析维度**:
- 历史价格走势
- 成交量变化
- 技术指标（MA、RSI 等）
- 与大盘对比

**数据来源**: yfinance API

### 3. Fundamental Agent（基本面分析）

**职责**: 分析公司基本面

**分析维度**:
- 财务报表（P/E, P/B, ROE 等）
- 盈利能力
- 成长性
- 行业对比

**数据来源**: yfinance API（财务数据）

### 4. Sentiment Agent（情绪分析）

**职责**: 分析市场情绪和新闻

**分析维度**:
- 新闻标题情感分析
- 社交媒体热度
- 分析师评级
- 整体市场情绪

**数据来源**: News API + LLM 分析

---

## 📊 报告结构

### 最终报告格式

```markdown
# 投资分析报告：[股票代码]

## 1. 执行摘要
（综合评估和投资建议）

## 2. 市场分析
- 价格走势
- 成交量分析
- 技术指标

## 3. 基本面分析
- 财务指标
- 盈利能力
- 成长性评估

## 4. 情绪分析
- 新闻摘要
- 市场情绪
- 分析师观点

## 5. 投资建议
（买入/持有/卖出，风险评级）
```

---

## 🔄 工作流程

### 用户请求处理流程

```
用户输入 "AAPL"
    │
    ▼
Orchestrator 解析请求
    │
    ├──→ Market Agent（异步）
    │       ↓
    │   获取价格数据、计算技术指标
    │       ↓
    │   返回市场分析
    │
    ├──→ Fundamental Agent（异步）
    │       ↓
    │   获取财务数据
    │       ↓
    │   返回基本面分析
    │
    └──→ Sentiment Agent（异步）
            ↓
        获取新闻、调用 LLM
            ↓
        返回情绪分析
    │
    ▼
Orchestrator 整合结果
    │
    ▼
调用 LLM 生成报告
    │
    ▼
返回给用户
```

---

## 💾 数据流

### 数据获取和处理

```python
# 示例：Market Agent 数据流
1. 接收股票代码 "AAPL"
2. 调用 yfinance.Ticker("AAPL")
3. 获取历史数据（1年）
4. 计算技术指标
   - SMA(20), SMA(50)
   - RSI
   - MACD
5. 格式化为 JSON
6. 返回给 Orchestrator
```

---

## 🛠️ 技术栈

### 后端
- **框架**: FastAPI
- **Agent**: 独立的 Python 模块
- **LLM**: OpenAI GPT-3.5/4
- **数据**: yfinance, News API

### 前端
- **框架**: Vue.js 2/3
- **UI**: 简单的聊天界面
- **通信**: HTTP REST API

### 部署
- **容器化**: Docker
- **编排**: Docker Compose

---

## 📁 项目结构（V1）

```
Magellan/
├── backend/
│   ├── orchestrator_agent.py      # 编排器
│   ├── market_agent.py             # 市场分析
│   ├── fundamental_agent.py        # 基本面分析
│   ├── sentiment_agent.py          # 情绪分析
│   ├── llm_client.py               # LLM 客户端
│   └── main.py                     # FastAPI 入口
│
├── frontend/
│   └── src/
│       ├── App.vue                 # 主应用
│       └── components/
│           └── ChatView.vue        # 聊天界面
│
└── docker-compose.yml
```

---

## 🎯 核心特性

### 1. 多 Agent 协作
- 三个专业 Agent 独立工作
- 并行执行，提高效率
- 结果整合

### 2. LLM 驱动
- 使用 GPT 生成自然语言报告
- 情绪分析依赖 LLM
- 智能总结和建议

### 3. 实时数据
- yfinance 实时股价
- News API 最新新闻
- 动态计算技术指标

---

## ⚠️ V1 的限制

### 功能限制
1. **仅支持股票** - 不支持其他资产类型
2. **无用户画像** - 所有用户得到相同报告
3. **无交互** - 一次性生成，无法追问
4. **数据源单一** - 仅依赖 yfinance

### 技术限制
1. **无状态管理** - 每次请求独立
2. **无缓存** - 重复请求重新计算
3. **简单 UI** - 基础聊天界面
4. **无错误恢复** - Agent 失败则整体失败

---

## 🚀 V1 到 V2 的演进

V2 针对 V1 的限制进行了以下改进：

1. **User Persona**
   - 引入用户投资画像
   - 个性化报告内容

2. **HITL（Human-in-the-Loop）**
   - 支持用户追问
   - 实时反馈机制

3. **改进的 UI**
   - 更好的交互体验
   - 报告可视化

4. **更强的 Agent**
   - 增加 Risk Agent
   - 改进分析质量

---

## 📊 性能指标（V1）

| 指标 | 性能 |
|------|------|
| 报告生成时间 | ~15-30 秒 |
| Agent 并行度 | 3 个并行 |
| API 调用次数 | ~5-10 次 |
| 报告字数 | ~800-1200 字 |

---

## 🎓 架构设计原则

### 1. 模块化
- 每个 Agent 独立
- 职责清晰
- 易于扩展

### 2. 可扩展性
- 新增 Agent 无需修改现有代码
- Orchestrator 支持动态注册

### 3. 异步执行
- Agent 并行工作
- 减少总体时间

---

## 💡 关键技术决策

### 为什么选择 FastAPI？
- 异步支持
- 自动 API 文档
- 类型提示

### 为什么选择 yfinance？
- 免费
- 数据全面
- 易于使用

### 为什么选择 OpenAI？
- 强大的 NLG 能力
- API 稳定
- 效果好

---

## 📚 相关文档

- [V1 开发计划](V1_Development_Plan.md)
- [V2 设计与计划](../V2/V2_Design_and_Plan.md)
- [V2 vs V3 对比](../V2/V2_vs_V3_Comparison.md)

---

**文档版本**: 1.0.0  
**最后更新**: 2025-10-22
