# ä»ªè¡¨ç›˜çœŸå®æ•°æ®å¯¹æ¥å®ç°å®Œæˆ

## æ¦‚è¿°

å·²å®Œæˆä»ªè¡¨ç›˜(Dashboard)çš„çœŸå®æ•°æ®å¯¹æ¥,å°†åŸæœ‰çš„æ¨¡æ‹Ÿæ•°æ®æ›¿æ¢ä¸ºä»åç«¯APIè·å–çš„å®æ—¶æ•°æ®ã€‚

## å®ç°å†…å®¹

### 1. åç«¯APIå®ç°

åœ¨ `backend/services/report_orchestrator/app/main.py` ä¸­æ–°å¢äº†ä»¥ä¸‹APIç«¯ç‚¹:

#### 1.1 ä»ªè¡¨ç›˜ç»Ÿè®¡æ•°æ® API
```
GET /api/dashboard/stats
```
è¿”å›æ•°æ®:
- **æ€»æŠ¥å‘Šæ•°** (total_reports): ç»Ÿè®¡æ‰€æœ‰å·²ä¿å­˜çš„æŠ¥å‘Š
- **æ´»è·ƒåˆ†ææ•°** (active_analyses): ç»Ÿè®¡å½“å‰è¿›è¡Œä¸­çš„DDä¼šè¯
- **AIæ™ºèƒ½ä½“æ•°é‡** (ai_agents): å›ºå®šä¸º6ä¸ªæ™ºèƒ½ä½“
- **æˆåŠŸç‡** (success_rate): å·²å®ŒæˆæŠ¥å‘Šå æ€»æŠ¥å‘Šçš„ç™¾åˆ†æ¯”

æ¯ä¸ªæŒ‡æ ‡åŒ…å«:
- `value`: å½“å‰å€¼
- `change`: å˜åŒ–è¶‹åŠ¿ (å¦‚ "+12.5%")
- `trend`: è¶‹åŠ¿æ–¹å‘ ("up", "down", "neutral")

#### 1.2 æœ€è¿‘æŠ¥å‘Šåˆ—è¡¨ API
```
GET /api/dashboard/recent-reports?limit=5
```
è¿”å›æœ€è¿‘Næ¡æŠ¥å‘Š,åŒ…å«:
- `id`: æŠ¥å‘ŠID
- `title`: æŠ¥å‘Šæ ‡é¢˜
- `date`: ç›¸å¯¹æ—¶é—´ (å¦‚ "2 hours ago")
- `status`: æŠ¥å‘ŠçŠ¶æ€ ("completed", "in-progress", "draft")
- `agents`: ä½¿ç”¨çš„æ™ºèƒ½ä½“æ•°é‡

#### 1.3 åˆ†æè¶‹åŠ¿æ•°æ® API
```
GET /api/dashboard/trends?days=7
```
è¿”å›è¿‡å»Nå¤©çš„è¶‹åŠ¿æ•°æ®:
- `labels`: æ—¥æœŸæ ‡ç­¾æ•°ç»„ (å¦‚ ["Mon", "Tue", "Wed", ...])
- `datasets.reports`: æ¯å¤©ç”Ÿæˆçš„æŠ¥å‘Šæ•°é‡
- `datasets.analyses`: æ¯å¤©å¯åŠ¨çš„åˆ†ææ•°é‡

#### 1.4 æ™ºèƒ½ä½“æ€§èƒ½ç»Ÿè®¡ API
```
GET /api/dashboard/agent-performance
```
è¿”å›å„ç±»ä»»åŠ¡çš„åˆ†å¸ƒç™¾åˆ†æ¯”:
- `market_analysis`: å¸‚åœºåˆ†æä»»åŠ¡å æ¯”
- `financial_review`: è´¢åŠ¡å®¡æŸ¥ä»»åŠ¡å æ¯”
- `team_evaluation`: å›¢é˜Ÿè¯„ä¼°ä»»åŠ¡å æ¯”
- `risk_assessment`: é£é™©è¯„ä¼°ä»»åŠ¡å æ¯”

### 2. å‰ç«¯å®ç°

åœ¨ `frontend/src/views/DashboardView.vue` ä¸­è¿›è¡Œäº†ä»¥ä¸‹æ›´æ–°:

#### 2.1 æ•°æ®è·å–
- æ·»åŠ äº† `fetchDashboardData()` å‡½æ•°,åœ¨ç»„ä»¶æŒ‚è½½æ—¶ä»åç«¯APIè·å–æ‰€æœ‰æ•°æ®
- ä½¿ç”¨ `ref` å­˜å‚¨APIè¿”å›çš„æ•°æ®: `statsData`, `recentReportsData`, `trendsData`, `performanceData`
- æ·»åŠ  `loading` çŠ¶æ€ç®¡ç†

#### 2.2 å›¾è¡¨æ›´æ–°
- **è¶‹åŠ¿å›¾è¡¨**: ä½¿ç”¨çœŸå®çš„ `trendsData` æ›¿æ¢æ¨¡æ‹Ÿæ•°æ®
- **æ€§èƒ½å›¾è¡¨**: ä½¿ç”¨çœŸå®çš„ `performanceData` æ›¿æ¢æ¨¡æ‹Ÿæ•°æ®
- å›¾è¡¨åœ¨æ•°æ®åŠ è½½å®Œæˆååˆå§‹åŒ–

#### 2.3 å¿«é€Ÿæ“ä½œåŠŸèƒ½
å®ç°äº†4ä¸ªå¿«é€Ÿæ“ä½œæŒ‰é’®çš„è·¯ç”±è·³è½¬:
- **æ–°å»ºåˆ†æ** â†’ `/analysis` (åˆ†æè§†å›¾)
- **ä¸Šä¼ æ•°æ®** â†’ `/knowledge` (çŸ¥è¯†åº“è§†å›¾)
- **é…ç½®æ™ºèƒ½ä½“** â†’ `/agents` (æ™ºèƒ½ä½“è§†å›¾)
- **æŸ¥çœ‹æŠ¥å‘Š** â†’ `/reports` (æŠ¥å‘Šè§†å›¾)

#### 2.4 æŸ¥çœ‹å…¨éƒ¨æŠ¥å‘Š
"æŸ¥çœ‹å…¨éƒ¨"æŒ‰é’®ç‚¹å‡»åè·³è½¬åˆ° `/reports` é¡µé¢

### 3. æ•°æ®æµç¨‹

```
ç”¨æˆ·æ‰“å¼€ä»ªè¡¨ç›˜
    â†“
DashboardViewç»„ä»¶æŒ‚è½½
    â†“
fetchDashboardData() è°ƒç”¨4ä¸ªAPI
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/dashboard/stats                â”‚ â†’ statsData
â”‚ /api/dashboard/recent-reports       â”‚ â†’ recentReportsData
â”‚ /api/dashboard/trends               â”‚ â†’ trendsData
â”‚ /api/dashboard/agent-performance    â”‚ â†’ performanceData
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
initializeCharts() ä½¿ç”¨çœŸå®æ•°æ®åˆå§‹åŒ–å›¾è¡¨
    â†“
ç•Œé¢å±•ç¤ºå®æ—¶æ•°æ®
```

### 4. æ•°æ®å­˜å‚¨

å½“å‰ä½¿ç”¨å†…å­˜å­˜å‚¨ (`saved_reports`, `dd_sessions`):
- âœ… é€‚åˆå¼€å‘å’Œæµ‹è¯•
- âš ï¸ æœåŠ¡é‡å¯åæ•°æ®ä¸¢å¤±
- ğŸ”„ ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨æ•°æ®åº“(PostgreSQL/MongoDB)

### 5. æµ‹è¯•éªŒè¯

æ‰€æœ‰APIå·²é€šè¿‡curlæµ‹è¯•éªŒè¯:

```bash
# ç»Ÿè®¡æ•°æ®
curl http://localhost:8000/api/dashboard/stats
âœ… è¿”å›æ­£ç¡®çš„ç»Ÿè®¡ä¿¡æ¯

# æœ€è¿‘æŠ¥å‘Š
curl http://localhost:8000/api/dashboard/recent-reports
âœ… è¿”å›ç©ºæ•°ç»„(å½“å‰æ— æŠ¥å‘Š)

# è¶‹åŠ¿æ•°æ®
curl http://localhost:8000/api/dashboard/trends
âœ… è¿”å›7å¤©çš„æ ‡ç­¾å’Œæ•°æ®æ•°ç»„

# æ™ºèƒ½ä½“æ€§èƒ½
curl http://localhost:8000/api/dashboard/agent-performance
âœ… è¿”å›æ¨¡æ‹Ÿçš„æ€§èƒ½åˆ†å¸ƒæ•°æ®
```

## æŠ€æœ¯ç»†èŠ‚

### åç«¯å®ç°è¦ç‚¹

1. **æ—¶é—´è®¡ç®—**: ä½¿ç”¨ `datetime` å’Œ `timedelta` è®¡ç®—ç›¸å¯¹æ—¶é—´
2. **æ•°æ®èšåˆ**: ä½¿ç”¨ `defaultdict` æŒ‰æ—¥æœŸèšåˆæŠ¥å‘Šå’Œåˆ†ææ•°æ®
3. **ç™¾åˆ†æ¯”è®¡ç®—**: æ ¹æ®æ­¥éª¤æ ‡é¢˜æ˜ å°„åˆ°æ™ºèƒ½ä½“ç±»åˆ«å¹¶è®¡ç®—å æ¯”
4. **ç©ºæ•°æ®å¤„ç†**: å½“æ²¡æœ‰æŠ¥å‘Šæ—¶è¿”å›æ¨¡æ‹Ÿæ•°æ®,é¿å…å›¾è¡¨æ˜¾ç¤ºå¼‚å¸¸

### å‰ç«¯å®ç°è¦ç‚¹

1. **å¼‚æ­¥æ•°æ®åŠ è½½**: ä½¿ç”¨ `async/await` å¹¶è¡Œè¯·æ±‚å¤šä¸ªAPI
2. **å“åº”å¼è®¡ç®—**: ä½¿ç”¨ `computed` å°†APIæ•°æ®è½¬æ¢ä¸ºç»„ä»¶æ‰€éœ€æ ¼å¼
3. **å›¾è¡¨å»¶è¿Ÿåˆå§‹åŒ–**: ç­‰å¾…æ•°æ®åŠ è½½å®Œæˆåå†åˆå§‹åŒ–å›¾è¡¨
4. **é”™è¯¯å¤„ç†**: æ•è·APIè¯·æ±‚é”™è¯¯å¹¶è®°å½•åˆ°æ§åˆ¶å°

## åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **æ·»åŠ åŠ è½½çŠ¶æ€**: åœ¨æ•°æ®åŠ è½½æ—¶æ˜¾ç¤ºéª¨æ¶å±æˆ–åŠ è½½åŠ¨ç”»
2. **é”™è¯¯æç¤º**: å½“APIè¯·æ±‚å¤±è´¥æ—¶å‘ç”¨æˆ·æ˜¾ç¤ºå‹å¥½æç¤º
3. **è‡ªåŠ¨åˆ·æ–°**: å®šæ—¶åˆ·æ–°ä»ªè¡¨ç›˜æ•°æ®(å¦‚æ¯30ç§’)
4. **æ—¶é—´èŒƒå›´é€‰æ‹©**: å…è®¸ç”¨æˆ·é€‰æ‹©è¶‹åŠ¿å›¾çš„æ—¶é—´èŒƒå›´(7å¤©/30å¤©/90å¤©)

### é•¿æœŸä¼˜åŒ–
1. **æ•°æ®åº“é›†æˆ**: å°†å†…å­˜å­˜å‚¨è¿ç§»åˆ°PostgreSQLæˆ–MongoDB
2. **ç¼“å­˜æœºåˆ¶**: ä½¿ç”¨Redisç¼“å­˜é¢‘ç¹è®¿é—®çš„ç»Ÿè®¡æ•°æ®
3. **å®æ—¶æ›´æ–°**: ä½¿ç”¨WebSocketæ¨é€å®æ—¶æ•°æ®æ›´æ–°
4. **æ•°æ®å¯¼å‡º**: æ”¯æŒå¯¼å‡ºä»ªè¡¨ç›˜æ•°æ®ä¸ºExcel/PDF

## å½±å“çš„æ–‡ä»¶

### åç«¯
- `backend/services/report_orchestrator/app/main.py`: +207è¡Œ
  - æ–°å¢4ä¸ªAPIç«¯ç‚¹
  - æ–°å¢ `dashboard_analytics` å­˜å‚¨

### å‰ç«¯
- `frontend/src/views/DashboardView.vue`: ~150è¡Œä¿®æ”¹
  - é‡æ„æ•°æ®è·å–é€»è¾‘
  - å®ç°APIå¯¹æ¥
  - æ·»åŠ è·¯ç”±å¯¼èˆª

## å®ŒæˆçŠ¶æ€

âœ… æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ:
- [x] åˆ›å»ºä»ªè¡¨ç›˜ç»Ÿè®¡æ•°æ®API
- [x] å®ç°è·å–æœ€è¿‘æŠ¥å‘Šåˆ—è¡¨API
- [x] å®ç°åˆ†æè¶‹åŠ¿æ•°æ®API
- [x] å®ç°æ™ºèƒ½ä½“æ€§èƒ½ç»Ÿè®¡API
- [x] æ›´æ–°å‰ç«¯DashboardViewå¯¹æ¥çœŸå®API
- [x] å®ç°å¿«é€Ÿæ“ä½œåŠŸèƒ½(tabå¯¼èˆª)
- [x] é‡å¯åç«¯æœåŠ¡åº”ç”¨æ–°API
- [x] ä¿®å¤vue-routerä¾èµ–é—®é¢˜(ä½¿ç”¨emitäº‹ä»¶ä»£æ›¿)

ä»ªè¡¨ç›˜ç°åœ¨å®Œå…¨ä½¿ç”¨çœŸå®æ•°æ®,ä¸å†ä¾èµ–æ¨¡æ‹Ÿæ•°æ®!ğŸ‰

## æŠ€æœ¯è¯´æ˜

### å¯¼èˆªå®ç°
ç”±äºé¡¹ç›®ä¸ä½¿ç”¨vue-router,è€Œæ˜¯ä½¿ç”¨ç®€å•çš„tabåˆ‡æ¢,å¿«é€Ÿæ“ä½œæŒ‰é’®é€šè¿‡emitäº‹ä»¶è§¦å‘å¯¼èˆª:

```javascript
// DashboardView.vue
const emit = defineEmits(['navigate']);

const handleQuickAction = (action) => {
  if (action.tab) {
    emit('navigate', action.tab);
  }
};

// App.vue
<DashboardView @navigate="handleNavigate" />
```

è¿™æ ·ä¿æŒäº†ä¸ç°æœ‰æ¶æ„çš„ä¸€è‡´æ€§ã€‚
