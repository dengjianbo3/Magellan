# AI 投资报告 Agent - V3 开发计划 (v1.1)

## 核心思想：分层实现，体验驱动

本计划旨在将V2的“二级市场分析工具”升级为V3的“一级市场投研工作台”。我们将严格遵循“**数据层 -> 逻辑层 -> 应用层 -> 高级能力**”的顺序，分层构建，确保每一步都有坚实的基础。

---

### **阶段一：数据层升级 - 对接一级市场信息源**

**目标：** 改造系统的数据输入和存储能力，使其能处理非结构化的私募项目材料，并对接内外部专业数据库。

*   **Sprint 1: “智能文档解析”核心能力构建**
    1.  **任务1 (后端/ML):** 升级`pdf_parser`。集成多模态模型（如Gemini Pro Vision）或开源LayoutLM，实现对BP（商业计划书）PDF的**布局感知解析**。
    2.  **任务2 (后端):** 定义关键信息提取的Schema。确定需要从BP中提取的核心字段（如团队成员、融资金额、市场规模、核心技术等）。
    3.  **里程碑测试：** **上传一份标准的BP PDF文件，新的`pdf_parser`服务应能返回一个结构化的JSON，其中包含从文档中正确提取的团队介绍和财务预测数据，而不仅仅是无格式的文本块。**

*   **Sprint 2: “内外部数据库与搜索”构建与对接**
    1.  **任务1 (后端):** 重构`public_data_service`为`external_data_service`。移除`yfinance`依赖，替换为一个一级市场API（例如，天眼查API），实现根据公司名查询工商信息和融资历史。
    2.  **任务2 (后端/DevOps):** 新建`internal_knowledge_service`。使用Docker部署一个向量数据库（如Weaviate或Milvus），并创建一个简单的FastAPI服务，提供文档上传（向量化）和语义搜索的API。
    3.  **任务3 (后端):** **(新增)** 新建`web_search_service`。创建一个封装Tavily API的FastAPI服务，提供一个简洁的接口用于实时网络搜索。
    4.  **里程碑测试：** **1. 调用`external_data_service`，输入一个公司名，能返回其融资历史。 2. 调用`internal_knowledge_service`，上传一篇行业分析，然后用一个相关问题进行搜索，应能成功检索到上传的文档。 3. 调用`web_search_service`，输入一个查询，能返回相关的网络搜索结果。**

---

### **阶段二：智能体与工作流重构 - 适配尽职调查(DD)逻辑**

**目标：** 将Agent的行为模式和协作流程从股票分析转变为一级市场的尽职调查辅助。

*   **Sprint 3: “DD工作流”与“核心分析模块”**
    1.  **任务1 (后端):** 重构`report_orchestrator`的状态机。将旧的工作流替换为新的**DD（尽职调查）流程**，并集成`web_search_service`作为数据收集的一环。
    2.  **任务2 (后端):** 进化`AnalysisAgent`。创建生成“团队分析”和“市场分析”模块的逻辑，使其能调用`external_data_service`和`web_search_service`的结果来交叉验证和撰写内容。
    3.  **里程碑测试：** **通过API触发一个新的DD工作流，传入一个公司名和一份BP。Orchestrator应能按顺序调用解析器、外部数据服务和网络搜索服务，并最终生成包含“团队分析”和“市场分析”两个章节的结构化文本。**

*   **Sprint 4: “风险Agent”与“机构偏好”集成**
    1.  **任务1 (后端):** 升级`RiskAgent`。修改其Prompt，使其生成的不再是通用问题，而是一个专业的、面向创始人的**DD问题清单**。
    2.  **任务2 (后端):** 升级`user_service`。扩展其数据模型和API，以支持存储和读取机构的“投资主题”、“偏好阶段”等信息。
    3.  **任务3 (后端):** 将“机构偏好”检查作为`OrchestratorAgent`工作流的**第一步**，实现快速的项目筛选。
    4.  **里程碑测试：** **在`user_service`中设置机构偏好为“只投SaaS”。然后，分析一个“生物科技”领域的项目。工作流应在第一步后就提前终止，并返回“项目与机构投资偏好不符”的明确信息。**

---

### **阶段三：UI/UX革新 - 打造投资备忘录(IM)工作台**

**目标：** 将前端从一个报告查看器，升级为一个可交互、可编辑的投资备忘录（IM）撰写和管理平台。

*   **Sprint 5: “IM草稿生成器”UI实现**
    1.  **任务1 (前端):** 重塑`InteractiveReportView.vue`。将左侧大纲更新为IM标准章节。最关键的是，将**中栏替换为一个富文本编辑器**（如集成TipTap或Quill.js）。
    2.  **任务2 (前端):** **(新增)** 更新全局CSS样式，将主色调从紫色系替换为**橘红色系**。
    3.  **任务3 (前端/后端):** 实现数据绑定。将后端在Sprint 3中生成的各分析模块内容，自动填充到富文本编辑器的对应章节中。
    4.  **里程碑测试：** **用户在`ChatView`中完成一次完整的DD流程后，点击“查看报告”，应用应能跳转到新的IM工作台视图，并且所有AI生成的分析内容都已正确载入到可编辑的富文本区域中。界面的主色调应显示为橘红色。**

*   **Sprint 6: “交互式助手”与“最终交付”**
    1.  **任务1 (前端):** 在右栏“Agent助手”中，新增**“内部洞察”**模块。该模块调用`internal_knowledge_service`的API，根据当前项目，显示内部相关的历史纪要。
    2.  **任务2 (前端):** 实现**“一键导出”**功能。添加一个按钮，可以将中栏富文本编辑器的内容导出为格式化的Word文档。
    3.  **任务3 (前端/后端):** 优化HITL节点。将第二个HITL节点的用户提示改为“添加您的访谈纪要”，并允许用户在此处上传新的文本或文件，后端接收后能触发对IM草稿的更新。
    4.  **里程碑测试：** **在IM工作台中，用户可以：1. 在右栏看到相关的内部文档提示。2. 在富文本编辑器中手动修改AI生成的内容。3. 点击导出，能下载一份包含所有修改后内容的.docx文件。**

---

### **阶段四：高级分析能力 (Post-MVP)**

**目标：** 为投研后期提供专业的估值和退出分析能力。

*   **Sprint 7: “估值与退出分析”**
    1.  **任务1 (后端/DevOps):** 新建`openbb_service`。部署OpenBB平台，并创建一个FastAPI服务来封装其“可比上市公司分析”功能。
    2.  **任务2 (后端):** 在`AnalysisAgent`中新增一个“财务与估值”模块。当用户请求时，该模块调用`openbb_service`获取可比公司的估值倍数，并结合项目自身的财务数据，给出一个初步的估值区间建议。
    3.  **里程碑测试：** **在IM工作台中，增加一个“请求估值分析”的按钮。点击后，`AnalysisAgent`应能调用OpenBB服务，获取数据，并最终在IM中追加一个新的“财务与估值”章节，其中包含可比公司列表及其关键估值指标。**