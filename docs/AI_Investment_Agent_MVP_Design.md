### **AI投资报告Agent - MVP产品设计文档**

#### 1. 愿景与目标

*   **核心理念：** 本产品的核心不是替代决策者，而是成为其思想的催化剂和整理工具。它通过结构化的报告和智能追问，帮助决策者**整理现有思路、发现潜在问题、提升决策质量**。
*   **目标用户：** 个人投资者、金融分析师、投资机构决策者。
*   **MVP目标：** 验证核心功能闭环，即从用户输入（公司名 + 本地资料）到生成一份结构完整、逻辑清晰、包含“合理追问”模块的投资报告。收集早期用户反馈，迭代报告质量和用户体验。

#### 2. 核心功能模块 (Functional Modules)

**模块一：数据输入与处理模块 (P0)**
*   **功能描述：** 产品的入口，用户在此提交分析目标和相关资料。
*   **设计要点：**
    1.  **公司名称输入：** 简单的文本框。
    2.  **本地资料上传：** 支持PDF、Excel、Word等多种格式文件上传。
    3.  **后台处理：** 自动进行结构化数据提取（财务数据）和非结构化数据解析（OCR/NLP提取市场、风险等信息）。

**模块二：智能分析与报告生成模块 (P0)**
*   **功能描述：** 产品的“大脑”，负责调用AI模型并生成报告核心内容。
*   **设计要点：**
    1.  **多维评估模型：** 从财务、市场、团队等多维度分析。
        *   *（P1）支持用户自定义各评估维度的权重，以匹配其投资策略。*
    2.  **行业对标分析：** 自动查找同类公司的成功与失败案例进行对比。
    3.  **核心报告内容生成：**
        *   公司简介、行业分析（含图表）、财务分析（含来源标注）、风险评估。
        *   **“合理追问”模块 (核心亮点):** 生成有深度的衍生问题。
            *   *（P1 核心亮点）支持用户输入对追问问题的回答，系统可结合新信息进行二次评估，形成动态分析闭环。*
        *   **投资建议：** 结合用户画像，给出倾向性建议及评分依据。

**模块三：用户画像与个性化模块 (P1)**
*   **功能描述：** 了解用户偏好，提供个性化体验。
*   **设计要点：**
    1.  **初次登录问卷：** 了解用户投资风格、风险偏好。
    2.  **报告模板选择：** 支持“精简摘要”或“详细报告”等模板。

**模块四：报告展示与交互模块 (P0)**
*   **功能描述：** 清晰、专业地呈现最终报告。
*   **设计要点：**
    1.  **结构化展示：** 清晰的目录和章节划分。
    2.  **图文并茂：** 嵌入可视化图表。
    3.  **交互功能：** 支持报告导出为PDF。

**模块五：项目管理与仪表盘 (P1)**
*   **功能描述：** 帮助用户管理和排序所有分析过的项目。
*   **设计要点：**
    1.  **分析列表：** 集中展示所有历史报告。
    2.  **智能分类与排序：** 系统根据报告内容自动为项目打上标签（如行业、阶段、风险等级），用户可基于此进行筛选和优先级排序。

---

#### 3. 系统架构设计 (System Architecture)

采用**前后端分离**的微服务架构，通过**事件驱动**的异步模式协作。

#### 4. 前端设计：“双核驱动”的智能工作站

前端将构建为一个双栏布局的“智能工作站”，完美承载“探索”与“生成”两大核心功能。

*   **技术栈:** `Vue 3 (Vite + TypeScript)`
*   **整体布局:**
    *   **左侧导航栏 (Sidebar):** 提供两个清晰的功能入口：“智能探索舱”和“深度报告生成器”。
    *   **右侧主工作区 (Main View):** 根据侧边栏的选择，动态切换显示对应的功能视图。
*   **设计风格:** 整体采用**玻璃拟态 (Glassmorphism)**风格，配合动态渐变背景，营造富有深度和高级感的视觉效果。

**两大核心功能视图:**

**A. 智能探索舱 (Chat View)**
*   **定位:** “探索与洞察Agent”的主界面，用于开放式的对话、快速问答和头脑风暴。
*   **核心交互:** 采用“智能驾驶舱”模式，将Agent的思考过程（如“获取数据”、“分析文档”）可视化为动态、实时的任务流节点，为用户提供即时反馈和交互。
*   **后端接口:** 此视图主要与后端的 `/chat` 对话式API端点交互。

**B. 深度报告生成器 (Deep Report View)**
*   **定位:** “报告生成Agent”的主界面，是一个专注、强大的工具，用于一键生成结构完整的深度投资报告。
*   **核心交互:** 提供清晰的表单界面，包含：
    1.  公司股票代码输入框。
    2.  一个支持拖拽和多文件上传的区域 (PDF, Word, Excel)。
    3.  “生成深度报告”按钮。
    4.  一个用于优雅地展示最终生成的多章节结构化报告的区域。
*   **后端接口:** 此视图主要与后端的 `/generate_full_report` 报告生成API端点交互。


##### 3.2 后端微服务设计 (Backend Microservices Design)

**架构图:**
```
                      +-------------------------+
[ 前端应用 ] <------> |   API 网关 (Gateway)    |
                      +-------------------------+
                             |         ^
                             V         |
+-----------------------------------------------------------------------------+
|                                  后端服务                                   |
|  +------------------+      +----------------------+      +----------------+  |
|  | 用户服务         |      | 报告编排服务 (大脑)  |<---->|  数据库 (Postgres) |
|  +------------------+      +----------------------+      +----------------+  |
|        ^                           |                                        |
|        |                           V                                        |
|  +------------------+      +----------------------+      +----------------+  |
|  | 文件接收服务     |----->| 消息队列 (RabbitMQ)  |<-----|  LLM 网关服务  |  |
|  +------------------+      +----------------------+      +----------------+  |
|                                    |   ^                                    |
|      +------------------+ +------------------+ +------------------+         |
|      | ...解析服务...   | | ...数据服务...   | | ...知识库服务... |         |
|      +------------------+ +------------------+ +------------------+         |
+-----------------------------------------------------------------------------+
```

**核心原子服务 (Atomic Services):**

*   **1. 文件接收与存储服务:** 接收文件，存入对象存储。
*   **2. PDF/Excel/Word解析服务:** 独立的服务，负责从对象存储拉取并解析不同格式的文件。
*   **3. 公开数据聚合服务:** 抓取公开市场的公司信息、新闻等。
*   **4. 内部知识库服务 (P1):** 安全地接入和处理企业客户的私有数据，与公开数据隔离。
*   **5. 大语言模型网关服务 (LLM Gateway):**
    *   **职责:** 统一封装对不同LLM的API调用。
    *   ***多LLM融合策略 (P1):*** 定义多种策略（如角色扮演、分工协作、投票制）来“揉合”多个模型的结果，以提升产出质量。
*   **6. 可视化图表生成服务:** 根据数据生成图表图片。
*   **7. 用户认证与画像服务:** 管理用户身份和个性化偏好。
*   **8. 报告编排与生成服务 (Orchestrator):** **后端大脑**，负责调用其他所有服务，编排完整的业务流程。

**工作流:** 采用异步事件驱动模式。前端提交请求后，由编排服务创建任务，并通过消息队列将解析、聚合等子任务分发给具体服务并行处理，处理完成后再由编排服务进行最终的AI调用和报告组装，并通过WebSocket或轮询通知前端。
