# Magellanç³»ç»Ÿæ¶æ„è“å›¾ä¸æ”¹é€ æ–¹æ¡ˆ

**ç‰ˆæœ¬**: V5 ç°çŠ¶åˆ†æ + V6 æ”¹é€ æ–¹æ¡ˆ
**æ—¥æœŸ**: 2025-11-15
**ç›®çš„**: å˜æ¸…å¾®æœåŠ¡æ¶æ„æ€è·¯ï¼ŒæŒ‡å¯¼ç³»ç»Ÿæ”¹é€ 

---

## ğŸ“ ä¸€ã€å½“å‰æ¶æ„å…¨æ™¯å›¾

### 1.1 æœåŠ¡æ‹“æ‰‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Vue 3 Frontend (Vite)                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ DashboardView    - ä»ªè¡¨ç›˜                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ AnalysisView     - DDåˆ†æå¯åŠ¨                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ ReportsView      - æŠ¥å‘Šç®¡ç†                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ AgentChatView    - å®æ—¶äº¤äº’                          â”‚  â”‚
â”‚  â”‚  â””â”€ RoundtableView   - åœ†æ¡Œè®¨è®º                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                 HTTP / WebSocket
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡ç¼–æ’å±‚ (æ ¸å¿ƒ)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Report Orchestrator (8000) â˜…æ ¸å¿ƒæœåŠ¡â˜…                   â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  [WebSocketç«¯ç‚¹]                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ /ws/start_dd_analysis     â†’ DDå·¥ä½œæµ                â”‚  â”‚
â”‚  â”‚  â”œâ”€ /ws/roundtable            â†’ åœ†æ¡Œè®¨è®º                â”‚  â”‚
â”‚  â”‚  â””â”€ /ws/conversation          â†’ å¯¹è¯äº¤äº’                â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  [REST API]                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/reports              â†’ æŠ¥å‘ŠCRUD                â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/dashboard/*          â†’ ä»ªè¡¨ç›˜æ•°æ®              â”‚  â”‚
â”‚  â”‚  â””â”€ /dd_session/{id}          â†’ ä¼šè¯æŸ¥è¯¢                â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  [æ ¸å¿ƒç»„ä»¶]                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ DDStateMachine            â†’ 6æ­¥å·¥ä½œæµçŠ¶æ€æœº         â”‚  â”‚
â”‚  â”‚  â”œâ”€ AgentEventBus             â†’ Agentäº‹ä»¶æ€»çº¿           â”‚  â”‚
â”‚  â”‚  â”œâ”€ IntentRecognizer          â†’ æ„å›¾è¯†åˆ«                â”‚  â”‚
â”‚  â”‚  â””â”€ ConversationManager       â†’ å¯¹è¯ç®¡ç†                â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  [å­˜å‚¨] âš ï¸ é—®é¢˜ï¼šå…¨éƒ¨åœ¨å†…å­˜ä¸­                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ dd_sessions: Dict         â†’ ä¼šè¯çŠ¶æ€                â”‚  â”‚
â”‚  â”‚  â””â”€ saved_reports: List       â†’ æŠ¥å‘Šæ•°æ®                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
              åŒæ­¥HTTPè°ƒç”¨ (æ‰€æœ‰æœåŠ¡)
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœåŠ¡èƒ½åŠ›å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ–‡ä»¶å¤„ç†æœåŠ¡      â”‚  â”‚ AI/LLMæœåŠ¡        â”‚  â”‚ æ•°æ®æœåŠ¡     â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚              â”‚ â”‚
â”‚  â”‚ File Service     â”‚  â”‚ LLM Gateway      â”‚  â”‚ User Service â”‚ â”‚
â”‚  â”‚ (8001)           â”‚  â”‚ (8003)           â”‚  â”‚ (8008)       â”‚ â”‚
â”‚  â”‚ âš ï¸ æœªè¢«ä½¿ç”¨       â”‚  â”‚ â”œâ”€ Gemini Chat   â”‚  â”‚ â”œâ”€ ç”¨æˆ·ç”»åƒ  â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚ â””â”€ File API      â”‚  â”‚ â””â”€ æŠ•èµ„åå¥½  â”‚ â”‚
â”‚  â”‚ Excel Parser     â”‚  â”‚                  â”‚  â”‚              â”‚ â”‚
â”‚  â”‚ (8004)           â”‚  â”‚ Web Search       â”‚  â”‚ External Dataâ”‚ â”‚
â”‚  â”‚ âš ï¸ æœªè¢«ä½¿ç”¨       â”‚  â”‚ (8010)           â”‚  â”‚ (8006)       â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚ â””â”€ Tavily API    â”‚  â”‚ âš ï¸ Mockå®ç°  â”‚ â”‚
â”‚  â”‚ Word Parser      â”‚  â”‚                  â”‚  â”‚              â”‚ â”‚
â”‚  â”‚ (8005)           â”‚  â”‚ Internal Know    â”‚  â”‚              â”‚ â”‚
â”‚  â”‚ âš ï¸ æœªè¢«ä½¿ç”¨       â”‚  â”‚ (8009)           â”‚  â”‚              â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚ â””â”€ ChromaDB      â”‚  â”‚              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸºç¡€è®¾æ–½å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å‘é‡æ•°æ®åº“   â”‚  â”‚ æ–‡ä»¶å­˜å‚¨      â”‚  â”‚ æ¶ˆæ¯é˜Ÿåˆ— (ç¦ç”¨)     â”‚   â”‚
â”‚  â”‚             â”‚  â”‚              â”‚  â”‚                     â”‚   â”‚
â”‚  â”‚ ChromaDB    â”‚  â”‚ Docker Volumeâ”‚  â”‚ RabbitMQ âœ—          â”‚   â”‚
â”‚  â”‚ (8011)      â”‚  â”‚ /var/uploads â”‚  â”‚ âš ï¸ å·²æ³¨é‡Š            â”‚   â”‚
â”‚  â”‚             â”‚  â”‚              â”‚  â”‚                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ å…³ç³»æ•°æ®åº“   â”‚  â”‚ ç¼“å­˜/ä¼šè¯å­˜å‚¨ â”‚                            â”‚
â”‚  â”‚ (ç¦ç”¨)      â”‚  â”‚ (ç¼ºå¤±)       â”‚                            â”‚
â”‚  â”‚             â”‚  â”‚              â”‚                            â”‚
â”‚  â”‚ PostgreSQL âœ—â”‚  â”‚ Redis âœ—      â”‚                            â”‚
â”‚  â”‚ âš ï¸ å·²æ³¨é‡Š    â”‚  â”‚ âš ï¸ æœªéƒ¨ç½²     â”‚                            â”‚
â”‚  â”‚             â”‚  â”‚              â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å›¾ä¾‹:
  â˜… = æ ¸å¿ƒæœåŠ¡
  âš ï¸ = é—®é¢˜æˆ–æœªä½¿ç”¨
  âœ— = å·²ç¦ç”¨
```

### 1.2 æœåŠ¡èŒè´£çŸ©é˜µ

| æœåŠ¡åç§° | ç«¯å£ | èŒè´£ | çŠ¶æ€ | ä¾èµ–æœåŠ¡ |
|---------|------|------|------|---------|
| **report_orchestrator** | 8000 | æ ¸å¿ƒç¼–æ’ã€çŠ¶æ€ç®¡ç†ã€WebSocket | âœ… è¿è¡Œ | llm_gateway, user_service, web_search, internal_knowledge, external_data |
| **file_service** | 8001 | æ–‡ä»¶ä¸Šä¼ ã€å­˜å‚¨ç®¡ç† | âš ï¸ æœªè¢«è°ƒç”¨ | - |
| **llm_gateway** | 8003 | LLMç»Ÿä¸€æ¥å£ã€Geminiä»£ç† | âœ… è¿è¡Œ | Gemini API (å¤–éƒ¨) |
| **excel_parser** | 8004 | Excelæ–‡ä»¶è§£æ | âš ï¸ æœªè¢«è°ƒç”¨ | file_service |
| **word_parser** | 8005 | Wordæ–‡ä»¶è§£æ | âš ï¸ æœªè¢«è°ƒç”¨ | file_service |
| **external_data** | 8006 | å…¬å¼€æ•°æ®è·å– | âš ï¸ Mock | å¤©çœ¼æŸ¥API (æœªé›†æˆ) |
| **user_service** | 8008 | ç”¨æˆ·ç”»åƒã€æŠ•èµ„åå¥½ | âœ… è¿è¡Œ | - |
| **internal_knowledge** | 8009 | å‘é‡æ£€ç´¢ã€çŸ¥è¯†åº“ | âœ… è¿è¡Œ | ChromaDB |
| **web_search** | 8010 | å®æ—¶ç½‘ç»œæœç´¢ | âœ… è¿è¡Œ | Tavily API (å¤–éƒ¨) |
| **chroma** | 8011 | å‘é‡æ•°æ®åº“ | âœ… è¿è¡Œ | - |

---

## ğŸ”„ äºŒã€æ•°æ®æµåˆ†æ

### 2.1 å®Œæ•´çš„DDåˆ†ææµç¨‹

```
ç”¨æˆ·æ“ä½œæµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 0: ç”¨æˆ·å‡†å¤‡                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‰ç«¯ (AnalysisView.vue)                                      â”‚
â”‚  â”œâ”€ å¡«å†™é¡¹ç›®ä¿¡æ¯ (company_name, project_name)                â”‚
â”‚  â”œâ”€ ä¸Šä¼ BPæ–‡ä»¶ (PDF/Excel/Word)                             â”‚
â”‚  â”œâ”€ é€‰æ‹©Agent (team-evaluator, market-analyst, ...)         â”‚
â”‚  â””â”€ ç‚¹å‡»"å¯åŠ¨åˆ†æ"                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: å»ºç«‹è¿æ¥                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‰ç«¯ ddAnalysisService.js                                    â”‚
â”‚  â”œâ”€ è¯»å–æ–‡ä»¶ â†’ è½¬æ¢ä¸ºbase64ç¼–ç  âš ï¸ é—®é¢˜ç‚¹                    â”‚
â”‚  â”œâ”€ åˆ›å»ºWebSocketè¿æ¥                                        â”‚
â”‚  â”‚  ws://localhost:8000/ws/start_dd_analysis                â”‚
â”‚  â””â”€ å‘é€JSONè¯·æ±‚:                                            â”‚
â”‚     {                                                        â”‚
â”‚       company_name: "æ™ºç®—ç§‘æŠ€",                              â”‚
â”‚       bp_file_base64: "JVBERi0xLjQK...",  â† æ•´ä¸ªæ–‡ä»¶base64  â”‚
â”‚       bp_filename: "BP.pdf",                                 â”‚
â”‚       selected_agents: ["team-evaluator", "market-analyst"],â”‚
â”‚       user_id: "investor_001"                                â”‚
â”‚     }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Report Orchestrator (main.py:426)                            â”‚
â”‚  â”œâ”€ WebSocketè¿æ¥å·²å»ºç«‹                                      â”‚
â”‚  â”œâ”€ æ¥æ”¶JSONè¯·æ±‚                                             â”‚
â”‚  â”œâ”€ è§£ç base64 â†’ äºŒè¿›åˆ¶æ•°æ® âš ï¸ å†…å­˜å ç”¨                      â”‚
â”‚  â”œâ”€ ç”Ÿæˆsession_id = "dd_æ™ºç®—ç§‘æŠ€_uuid"                      â”‚
â”‚  â”œâ”€ åˆ›å»ºDDSessionContextå¯¹è±¡                                 â”‚
â”‚  â””â”€ åˆå§‹åŒ–DDStateMachine                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: çŠ¶æ€æœºæ‰§è¡Œ (dd_state_machine.py)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ State: INIT                                                  â”‚
â”‚  â”œâ”€ å‘é€WebSocketæ¶ˆæ¯: "æ­£åœ¨åˆå§‹åŒ–..."                       â”‚
â”‚  â”œâ”€ HTTP GET â†’ user_service:8008/users/{user_id}            â”‚
â”‚  â”‚  â””â”€ è·å–ç”¨æˆ·æŠ•èµ„ç”»åƒ                                      â”‚
â”‚  â””â”€ å­˜å‚¨åˆ°context.user_persona                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State: DOC_PARSE (BPè§£æ)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ å‘é€WebSocket: "æ­£åœ¨è§£æå•†ä¸šè®¡åˆ’ä¹¦..."                   â”‚
â”‚  â”œâ”€ HTTP POST â†’ llm_gateway:8003/generate_from_file          â”‚
â”‚  â”‚  â””â”€ ä¸Šä¼ bp_file_contentåˆ°Gemini File API                 â”‚
â”‚  â”‚  â””â”€ Prompt: "è¯·åˆ†æè¿™ä»½BPå¹¶æå–ç»“æ„åŒ–ä¿¡æ¯..."             â”‚
â”‚  â”‚  â””â”€ å“åº”: {company_info, team, market, financials, ...}  â”‚
â”‚  â”œâ”€ è§£æLLMå“åº”ä¸ºBPStructuredData                            â”‚
â”‚  â””â”€ å­˜å‚¨åˆ°context.bp_data                                    â”‚
â”‚                                                              â”‚
â”‚  è€—æ—¶: 5-10ç§’                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State: TDD (å›¢é˜Ÿå°½èŒè°ƒæŸ¥)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ å‘é€WebSocket: "æ­£åœ¨åˆ†æå›¢é˜Ÿ..."                         â”‚
â”‚  â”œâ”€ TeamAnalysisAgent.analyze()                             â”‚
â”‚  â”‚  â”œâ”€ HTTP POST â†’ web_search:8010/search                   â”‚
â”‚  â”‚  â”‚  â””â”€ æŸ¥è¯¢: "å¼ ä¸‰ æ™ºç®—ç§‘æŠ€ CEO èƒŒæ™¯"                     â”‚
â”‚  â”‚  â”‚  â””â”€ è¿”å›: [{title, url, content, score}, ...]         â”‚
â”‚  â”‚  â”œâ”€ HTTP POST â†’ llm_gateway:8003/chat                    â”‚
â”‚  â”‚  â”‚  â””â”€ Prompt: "åŸºäºBPå’Œç½‘ç»œæœç´¢ï¼Œè¯„ä¼°å›¢é˜Ÿ..."           â”‚
â”‚  â”‚  â”‚  â””â”€ å“åº”: {summary, strengths, concerns, ...}         â”‚
â”‚  â”‚  â””â”€ è§£æä¸ºTeamAnalysisOutput                             â”‚
â”‚  â””â”€ å­˜å‚¨åˆ°context.team_analysis                              â”‚
â”‚                                                              â”‚
â”‚  è€—æ—¶: 10-20ç§’                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State: MDD (å¸‚åœºå°½èŒè°ƒæŸ¥)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ å‘é€WebSocket: "æ­£åœ¨åˆ†æå¸‚åœº..."                         â”‚
â”‚  â”œâ”€ MarketAnalysisAgent.analyze()                           â”‚
â”‚  â”‚  â”œâ”€ HTTP POST â†’ web_search:8010/search                   â”‚
â”‚  â”‚  â”‚  â””â”€ æŸ¥è¯¢: "AIç®—åŠ›å¸‚åœº è§„æ¨¡ è¶‹åŠ¿ 2024"                 â”‚
â”‚  â”‚  â”œâ”€ HTTP POST â†’ internal_knowledge:8009/search           â”‚
â”‚  â”‚  â”‚  â””â”€ æŸ¥è¯¢: "ç®—åŠ› èµ›é“ æŠ•èµ„ é¡¹ç›®"                       â”‚
â”‚  â”‚  â”‚  â””â”€ ChromaDBå‘é‡æ£€ç´¢å†å²é¡¹ç›®                          â”‚
â”‚  â”‚  â”œâ”€ HTTP POST â†’ llm_gateway:8003/chat                    â”‚
â”‚  â”‚  â”‚  â””â”€ Prompt: "éªŒè¯å¸‚åœºè§„æ¨¡ï¼Œåˆ†æç«äº‰..."               â”‚
â”‚  â”‚  â”‚  â””â”€ å“åº”: {summary, market_validation, ...}           â”‚
â”‚  â”‚  â””â”€ è§£æä¸ºMarketAnalysisOutput                           â”‚
â”‚  â””â”€ å­˜å‚¨åˆ°context.market_analysis                            â”‚
â”‚                                                              â”‚
â”‚  è€—æ—¶: 20-40ç§’                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State: CROSS_CHECK (äº¤å‰éªŒè¯)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ å‘é€WebSocket: "æ­£åœ¨äº¤å‰éªŒè¯æ•°æ®..."                     â”‚
â”‚  â”œâ”€ å¯¹æ¯”BPå£°ç§° vs å¤–éƒ¨æ•°æ®                                   â”‚
â”‚  â”‚  â”œâ”€ å›¢é˜ŸèƒŒæ™¯æ˜¯å¦ä¸€è‡´                                     â”‚
â”‚  â”‚  â”œâ”€ å¸‚åœºè§„æ¨¡æ˜¯å¦å¤¸å¤§                                     â”‚
â”‚  â”‚  â””â”€ è´¢åŠ¡é¢„æµ‹æ˜¯å¦åˆç†                                     â”‚
â”‚  â””â”€ ç”ŸæˆCrossCheckResultåˆ—è¡¨                                 â”‚
â”‚                                                              â”‚
â”‚  è€—æ—¶: 5-10ç§’                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State: DD_QUESTIONS (ç”Ÿæˆè¿½é—®æ¸…å•)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ å‘é€WebSocket: "æ­£åœ¨ç”Ÿæˆå…³é”®è¿½é—®..."                     â”‚
â”‚  â”œâ”€ åŸºäºåˆ†æç»“æœç”ŸæˆDDQuestion                               â”‚
â”‚  â”‚  â”œâ”€ ç±»åˆ«: Team/Market/Product/Financial/Risk            â”‚
â”‚  â”‚  â”œâ”€ ä¼˜å…ˆçº§: High/Medium/Low                              â”‚
â”‚  â”‚  â””â”€ æ¨ç†: ä¸ºä»€ä¹ˆè¦é—®è¿™ä¸ªé—®é¢˜                             â”‚
â”‚  â””â”€ å­˜å‚¨åˆ°context.dd_questions                               â”‚
â”‚                                                              â”‚
â”‚  è€—æ—¶: 5-10ç§’                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State: HITL_REVIEW (äººå·¥å®¡æŸ¥) âš ï¸ å¯é€‰                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ å‘é€WebSocket: status="hitl_required"                    â”‚
â”‚  â”œâ”€ å‰ç«¯æ˜¾ç¤ºåˆæ­¥æŠ¥å‘Š                                         â”‚
â”‚  â”œâ”€ ç”¨æˆ·å¯ä»¥:                                                â”‚
â”‚  â”‚  â”œâ”€ ç¡®è®¤å¹¶ç»§ç»­                                           â”‚
â”‚  â”‚  â”œâ”€ ä¿®æ”¹æŸäº›åˆ†æ                                         â”‚
â”‚  â”‚  â””â”€ æ·»åŠ é¢å¤–é—®é¢˜                                         â”‚
â”‚  â””â”€ ç­‰å¾…ç”¨æˆ·åé¦ˆ (WebSocketæ¥æ”¶)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State: COMPLETED (ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ æ•´åˆæ‰€æœ‰åˆ†æç»“æœ                                         â”‚
â”‚  â”œâ”€ ç”ŸæˆPreliminaryIM (Investment Memo)                      â”‚
â”‚  â”‚  â”œâ”€ bp_structured_data                                   â”‚
â”‚  â”‚  â”œâ”€ team_section                                         â”‚
â”‚  â”‚  â”œâ”€ market_section                                       â”‚
â”‚  â”‚  â”œâ”€ cross_check_results                                  â”‚
â”‚  â”‚  â””â”€ dd_questions                                         â”‚
â”‚  â”œâ”€ å‘é€WebSocket: status="completed"                        â”‚
â”‚  â”‚  â””â”€ åŒ…å«å®Œæ•´çš„preliminary_im                             â”‚
â”‚  â””â”€ ä¿å­˜åˆ°å†…å­˜: saved_reports.append() âš ï¸ é—®é¢˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: å‰ç«¯æ¥æ”¶å¹¶å±•ç¤º                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‰ç«¯ AgentChatView.vue                                        â”‚
â”‚  â”œâ”€ å®æ—¶æ¥æ”¶WebSocketæ¶ˆæ¯                                    â”‚
â”‚  â”œâ”€ æ›´æ–°è¿›åº¦æ¡ (æ¯ä¸ªstepå®Œæˆ)                                â”‚
â”‚  â”œâ”€ æ˜¾ç¤ºAgentæ€è€ƒè¿‡ç¨‹                                        â”‚
â”‚  â”œâ”€ æ˜¾ç¤ºæœ€ç»ˆæŠ¥å‘Š                                             â”‚
â”‚  â””â”€ æä¾›ä¿å­˜/å¯¼å‡ºæŒ‰é’®                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€»è€—æ—¶: 45-90ç§’
```

### 2.2 é—®é¢˜ç‚¹ï¼šæ–‡ä»¶ä¸Šä¼ çš„æ–­è£‚

**è®¾è®¡æ„å›¾** (æ¶æ„å›¾ä¸­çš„ç†æƒ³æµç¨‹):
```
å‰ç«¯
  â†“ HTTP multipart/form-data
File Service (8001)
  â”œâ”€ ä¿å­˜åˆ° /var/uploads
  â””â”€ è¿”å› file_id
      â†“
Excel/Word Parser (8004/8005)
  â”œâ”€ è¯»å– /var/uploads/{file_id}
  â””â”€ è§£æå¹¶è¿”å›ç»“æ„åŒ–æ•°æ®
      â†“
Report Orchestrator
  â””â”€ ä½¿ç”¨è§£æåçš„æ•°æ®
```

**å®é™…æƒ…å†µ** (å½“å‰å®ç°):
```
å‰ç«¯
  â”œâ”€ base64ç¼–ç æ•´ä¸ªæ–‡ä»¶ âš ï¸
  â””â”€ WebSocketå‘é€ (100MB â†’ 133MBå­—ç¬¦ä¸²)
      â†“
Report Orchestrator
  â”œâ”€ base64è§£ç  âš ï¸ å†…å­˜å ç”¨
  â””â”€ ç›´æ¥å¤„ç†
      â”œâ”€ file_serviceè¢«è·³è¿‡ âœ—
      â”œâ”€ excel_parserè¢«è·³è¿‡ âœ—
      â””â”€ word_parserè¢«è·³è¿‡ âœ—
```

**ä¸ºä»€ä¹ˆè¢«è·³è¿‡**:
1. File Serviceä»£ç æœ‰bug (`SHARED_VOLUME_PATH`æœªå®šä¹‰)
2. WebSocketå¯ä»¥ç›´æ¥ä¼ base64ï¼Œçœ‹ä¼¼æ›´ç®€å•
3. å¼€å‘æ—¶é—´å‹åŠ›ï¼Œé€‰æ‹©æœ€å¿«è·¯å¾„

**åæœ**:
- å¤§æ–‡ä»¶(>50MB)å¯¼è‡´å†…å­˜æº¢å‡º
- æ–‡ä»¶æ²¡æœ‰æŒä¹…åŒ–å­˜å‚¨
- æ–‡ä»¶è§£ææœåŠ¡æµªè´¹
- æ— æ³•æ”¯æŒæ–­ç‚¹ç»­ä¼ 

---

## ğŸ”´ ä¸‰ã€æ ¸å¿ƒæ¶æ„é—®é¢˜åˆ†æ

### 3.1 é—®é¢˜1: æ•°æ®æŒä¹…åŒ–ç¼ºå¤±

**æ¶æ„å±‚é¢çš„æ ¹å› **:
```
å½“å‰æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Report Orchestrator â”‚
â”‚  â”œâ”€ dd_sessions     â”‚ â† Python Dict (å†…å­˜)
â”‚  â””â”€ saved_reports   â”‚ â† Python List (å†…å­˜)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        âœ— æ— æŒä¹…åŒ–å±‚
        âœ— æ— å…±äº«çŠ¶æ€
        âœ— æ— æ³•æ‰©å±•

é—®é¢˜:
1. å®¹å™¨é‡å¯ â†’ æ•°æ®å…¨ä¸¢
2. å¤šå®ä¾‹éƒ¨ç½² â†’ çŠ¶æ€ä¸åŒæ­¥
3. é•¿æ—¶é—´åˆ†æ â†’ å®¹æ˜“ä¸­æ–­
```

**åº”è¯¥çš„æ¶æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Report Orchestrator â”‚
â”‚  (Stateless)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Redis Client
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Redis     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚ Sessionâ”‚ â”‚ â† dd_sessions (æŒä¹…åŒ–)
    â”‚  â”‚ Reportsâ”‚ â”‚ â† saved_reports (æŒä¹…åŒ–)
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¥½å¤„:
âœ“ å®¹å™¨é‡å¯ä¸ä¸¢æ•°æ®
âœ“ å¤šå®ä¾‹å…±äº«çŠ¶æ€
âœ“ æ”¯æŒä¼šè¯æ¢å¤
```

### 3.2 é—®é¢˜2: æœåŠ¡é—´è€¦åˆè¿‡ç´§

**å½“å‰æ¶æ„**:
```
Report Orchestrator (ç¼–æ’è€…)
  â”‚
  â”œâ”€â†’ ç›´æ¥HTTPè°ƒç”¨ llm_gateway
  â”œâ”€â†’ ç›´æ¥HTTPè°ƒç”¨ web_search
  â”œâ”€â†’ ç›´æ¥HTTPè°ƒç”¨ internal_knowledge
  â””â”€â†’ ç›´æ¥HTTPè°ƒç”¨ user_service

é—®é¢˜:
- åŒæ­¥é˜»å¡ (ä¸€ä¸ªæœåŠ¡æ…¢ï¼Œå…¨éƒ¨ç­‰å¾…)
- çº§è”å¤±è´¥ (ä¸€ä¸ªæœåŠ¡æŒ‚ï¼Œåˆ†æä¸­æ–­)
- æ— æ³•è§£è€¦ (ç¡¬ç¼–ç ä¾èµ–)
- æ— æ³•å¼‚æ­¥ (å¿…é¡»ç­‰å¾…å“åº”)
```

**åº”è¯¥çš„æ¶æ„** (å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—):
```
Report Orchestrator
  â†“ å‘å¸ƒä»»åŠ¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RabbitMQ       â”‚
â”‚  â”œâ”€ tdd_queue    â”‚ â†’ TDD Worker (å¯æ‰©å±•)
â”‚  â”œâ”€ mdd_queue    â”‚ â†’ MDD Worker (å¯æ‰©å±•)
â”‚  â””â”€ parse_queue  â”‚ â†’ Parser Worker
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ è®¢é˜…ç»“æœ
Report Orchestrator
  â””â”€ èšåˆç»“æœ

å¥½å¤„:
âœ“ å¼‚æ­¥å¤„ç† (ä¸é˜»å¡)
âœ“ ä»»åŠ¡é‡è¯• (å¤±è´¥è‡ªåŠ¨é‡è¯•)
âœ“ æ°´å¹³æ‰©å±• (å¤šWorker)
âœ“ è§£è€¦æœåŠ¡ (é€šè¿‡é˜Ÿåˆ—)
```

### 3.3 é—®é¢˜3: ç¼ºä¹ç»Ÿä¸€å…¥å£

**å½“å‰æ¶æ„**:
```
å‰ç«¯
  â”œâ”€â†’ http://localhost:8000 (Report Orchestrator)
  â”œâ”€â†’ http://localhost:8001 (File Service)
  â”œâ”€â†’ http://localhost:8008 (User Service)
  â””â”€â†’ ws://localhost:8000/ws (WebSocket)

é—®é¢˜:
- ç¡¬ç¼–ç å¤šä¸ªURL
- å‰ç«¯ç›´æ¥è°ƒç”¨å†…éƒ¨æœåŠ¡
- æ— æ³•ç»Ÿä¸€è®¤è¯
- æ— æ³•ç»Ÿä¸€ç›‘æ§
```

**åº”è¯¥çš„æ¶æ„** (API Gateway):
```
å‰ç«¯
  â†“ ç»Ÿä¸€å…¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway       â”‚
â”‚   (Nginx/Kong)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è®¤è¯ä¸­é—´ä»¶     â”‚  â”‚
â”‚  â”‚ é™æµä¸­é—´ä»¶     â”‚  â”‚
â”‚  â”‚ æ—¥å¿—ä¸­é—´ä»¶     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ è·¯ç”±è§„åˆ™
    â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼      â–¼          â–¼
  Report  User     File
   Orch  Service  Service

å¥½å¤„:
âœ“ ç»Ÿä¸€è®¤è¯ (JWTéªŒè¯)
âœ“ ç»Ÿä¸€é™æµ (é˜²æ»¥ç”¨)
âœ“ ç»Ÿä¸€æ—¥å¿— (è¿½è¸ª)
âœ“ çµæ´»è·¯ç”± (è“ç»¿éƒ¨ç½²)
```

### 3.4 é—®é¢˜4: ç¼ºä¹å¯è§‚æµ‹æ€§

**å½“å‰æ¶æ„**:
```
11ä¸ªå¾®æœåŠ¡
  â”œâ”€ stdoutæ—¥å¿— (åˆ†æ•£)
  â”œâ”€ æ— æŒ‡æ ‡æ”¶é›†
  â”œâ”€ æ— åˆ†å¸ƒå¼è¿½è¸ª
  â””â”€ æ— å‘Šè­¦æœºåˆ¶

é—®é¢˜:
- æ— æ³•å®šä½æ€§èƒ½ç“¶é¢ˆ
- æ— æ³•è¿½è¸ªè¯·æ±‚é“¾è·¯
- æ— æ³•é¢„è­¦æ•…éšœ
- æ— æ³•ä¼˜åŒ–ç³»ç»Ÿ
```

**åº”è¯¥çš„æ¶æ„** (å¯è§‚æµ‹æ€§ä¸‰æ”¯æŸ±):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            åº”ç”¨æœåŠ¡                      â”‚
â”‚  â”œâ”€ Report Orchestrator                 â”‚
â”‚  â”œâ”€ LLM Gateway                         â”‚
â”‚  â””â”€ ...                                 â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚             â”‚              â”‚
    â–¼             â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Logs    â”‚  â”‚ Metrics â”‚  â”‚ Traces   â”‚
â”‚ (ELK)   â”‚  â”‚(Prometheus)â”‚(Jaeger)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚             â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Grafana â”‚   â”‚ Alertingâ”‚
      â”‚(å¯è§†åŒ–) â”‚   â”‚ (å‘Šè­¦)  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¥½å¤„:
âœ“ é›†ä¸­æŸ¥è¯¢æ—¥å¿—
âœ“ æ€§èƒ½æŒ‡æ ‡ç›‘æ§
âœ“ åˆ†å¸ƒå¼è¿½è¸ª
âœ“ è‡ªåŠ¨å‘Šè­¦
```

---

## ğŸ¯ å››ã€æ¶æ„æ”¹é€ æ€»ä½“æ–¹å‘

### 4.1 æ”¹é€ åŸåˆ™

```
1. ç¨³å®šæ€§ä¼˜å…ˆ
   â”œâ”€ å…ˆä¿®å¤æ•°æ®æŒä¹…åŒ– (æœ€ä¸¥é‡)
   â”œâ”€ å†å®Œå–„é”™è¯¯å¤„ç†
   â””â”€ æœ€åä¼˜åŒ–æ€§èƒ½

2. æœ€å°åŒ–æ”¹åŠ¨
   â”œâ”€ ä¼˜å…ˆä½¿ç”¨ç°æœ‰æœåŠ¡
   â”œâ”€ é¿å…æ¨å€’é‡æ¥
   â””â”€ é€æ­¥é‡æ„

3. å‘åå…¼å®¹
   â”œâ”€ ä¸ç ´åç°æœ‰API
   â”œâ”€ æ”¯æŒå¹³æ»‘è¿ç§»
   â””â”€ ä¿ç•™é™çº§æ–¹æ¡ˆ

4. å¯è§‚æµ‹æ€§å…ˆè¡Œ
   â”œâ”€ æ‰€æœ‰æ”¹åŠ¨åŠ æ—¥å¿—
   â”œâ”€ å…³é”®è·¯å¾„åŠ è¿½è¸ª
   â””â”€ é‡è¦æŒ‡æ ‡åŠ ç›‘æ§
```

### 4.2 æ¶æ„æ¼”è¿›è·¯çº¿

```
é˜¶æ®µ1: åŸºç¡€ä¿®å¤ (V5 â†’ V6)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›®æ ‡: æ ¸å¿ƒå¯ç”¨ï¼Œæ•°æ®ä¸ä¸¢å¤±            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ·»åŠ Redis                         â”‚
â”‚    â””â”€ ä¼šè¯æŒä¹…åŒ–                     â”‚
â”‚    â””â”€ æŠ¥å‘ŠæŒä¹…åŒ–                     â”‚
â”‚                                      â”‚
â”‚ 2. ä¿®å¤æ–‡ä»¶ä¸Šä¼                       â”‚
â”‚    â””â”€ å¯ç”¨File Service               â”‚
â”‚    â””â”€ ä¸¤æ­¥ä¸Šä¼ æµç¨‹                   â”‚
â”‚                                      â”‚
â”‚ 3. WebSocketç¨³å®šæ€§                   â”‚
â”‚    â””â”€ å¿ƒè·³æœºåˆ¶                       â”‚
â”‚    â””â”€ æ¶ˆæ¯é˜Ÿåˆ—                       â”‚
â”‚                                      â”‚
â”‚ 4. åŸºç¡€è®¤è¯                          â”‚
â”‚    â””â”€ JWT Token                      â”‚
â”‚    â””â”€ æƒé™æ£€æŸ¥                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2: æœåŠ¡è§£è€¦ (V6 â†’ V7)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›®æ ‡: ç³»ç»Ÿç¨³å®šï¼Œå¯æ‰©å±•               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. API Gateway                       â”‚
â”‚    â””â”€ Nginxç»Ÿä¸€å…¥å£                  â”‚
â”‚    â””â”€ è·¯ç”±é…ç½®                       â”‚
â”‚                                      â”‚
â”‚ 2. æ¶ˆæ¯é˜Ÿåˆ—                          â”‚
â”‚    â””â”€ RabbitMQå¯ç”¨                   â”‚
â”‚    â””â”€ Workerè¿›ç¨‹                     â”‚
â”‚                                      â”‚
â”‚ 3. é…ç½®ä¸­å¿ƒ                          â”‚
â”‚    â””â”€ ç¯å¢ƒå˜é‡ç®¡ç†                   â”‚
â”‚    â””â”€ æœåŠ¡å‘ç°                       â”‚
â”‚                                      â”‚
â”‚ 4. å¯è§‚æµ‹æ€§                          â”‚
â”‚    â””â”€ PrometheusæŒ‡æ ‡                 â”‚
â”‚    â””â”€ Jaegerè¿½è¸ª                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ3: é«˜å¯ç”¨ (V7 â†’ V8)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›®æ ‡: ç”Ÿäº§å°±ç»ªï¼Œé«˜å¯ç”¨               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æœåŠ¡ç½‘æ ¼                          â”‚
â”‚    â””â”€ Istio/Linkerd                  â”‚
â”‚    â””â”€ æµé‡ç®¡ç†                       â”‚
â”‚                                      â”‚
â”‚ 2. æ•°æ®å¤‡ä»½                          â”‚
â”‚    â””â”€ RedisæŒä¹…åŒ–                    â”‚
â”‚    â””â”€ å®šæœŸå¤‡ä»½                       â”‚
â”‚                                      â”‚
â”‚ 3. ç¾éš¾æ¢å¤                          â”‚
â”‚    â””â”€ å¤šåœ°åŸŸéƒ¨ç½²                     â”‚
â”‚    â””â”€ æ•…éšœåˆ‡æ¢                       â”‚
â”‚                                      â”‚
â”‚ 4. æ€§èƒ½ä¼˜åŒ–                          â”‚
â”‚    â””â”€ LLMç¼“å­˜                        â”‚
â”‚    â””â”€ CDNåŠ é€Ÿ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ç›®æ ‡æ¶æ„ (V6)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å‰ç«¯ (Vue 3)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   API Gateway (Nginx)        â”‚
        â”‚  â”œâ”€ è®¤è¯ä¸­é—´ä»¶ (JWT)          â”‚
        â”‚  â”œâ”€ é™æµä¸­é—´ä»¶                â”‚
        â”‚  â””â”€ è·¯ç”±è§„åˆ™                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚
        â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Report Orch       â”‚      â”‚ Other Services   â”‚
â”‚ (æ— çŠ¶æ€)          â”‚      â”‚ (User/File/...)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ è¯»å†™ä¼šè¯
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Redis     â”‚ â† ä¼šè¯/æŠ¥å‘Šå­˜å‚¨
   â”‚  (æŒä¹…åŒ–)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ å‘å¸ƒä»»åŠ¡
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  RabbitMQ   â”‚ â† å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
   â”‚  â”œâ”€ TDD     â”‚
   â”‚  â”œâ”€ MDD     â”‚
   â”‚  â””â”€ Parse   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ Workerè®¢é˜…
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Workers    â”‚ â† å¯æ°´å¹³æ‰©å±•
   â”‚  (å¤šå®ä¾‹)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ è°ƒç”¨AIæœåŠ¡
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ LLM Gateway â”‚
   â”‚ Web Search  â”‚
   â”‚ Internal KB â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ å­˜å‚¨å‘é‡
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ChromaDB   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ æŒ‡æ ‡/æ—¥å¿—/è¿½è¸ª
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Observabilityâ”‚
   â”‚ â”œâ”€ Prometheusâ”‚
   â”‚ â”œâ”€ Jaeger    â”‚
   â”‚ â””â”€ Grafana   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ äº”ã€æ”¹é€ å®æ–½è®¡åˆ’

### 5.1 Phase 1: åŸºç¡€ä¿®å¤ (ç¬¬1-2å‘¨)

#### Week 1: æŒä¹…åŒ– + æ–‡ä»¶ä¸Šä¼ 

**ä»»åŠ¡1: Redisé›†æˆ** (ä¼˜å…ˆçº§P0)
```yaml
ç›®æ ‡: ä¼šè¯å’ŒæŠ¥å‘ŠæŒä¹…åŒ–
å·¥æ—¶: 12å°æ—¶

æ­¥éª¤:
1. docker-compose.ymlæ·»åŠ redisæœåŠ¡
   â””â”€ image: redis:7-alpine
   â””â”€ volumes: redis_data:/data
   â””â”€ healthchecké…ç½®

2. åˆ›å»ºSessionStoreç±»
   â””â”€ backend/services/report_orchestrator/app/core/session_store.py
   â””â”€ save_session(session_id, context)
   â””â”€ get_session(session_id)
   â””â”€ delete_session(session_id)

3. æ›¿æ¢å†…å­˜å­˜å‚¨
   â””â”€ main.py: åˆ é™¤dd_sessionså­—å…¸
   â””â”€ main.py: ä½¿ç”¨SessionStore

4. æµ‹è¯•éªŒè¯
   â””â”€ å¯åŠ¨åˆ†æ â†’ é‡å¯å®¹å™¨ â†’ æŸ¥è¯¢ä¼šè¯
   â””â”€ åº”è¯¥èƒ½æ¢å¤çŠ¶æ€
```

**ä»»åŠ¡2: æ–‡ä»¶ä¸Šä¼ ä¿®å¤** (ä¼˜å…ˆçº§P0)
```yaml
ç›®æ ‡: æ–‡ä»¶é€šè¿‡File Serviceä¸Šä¼ 
å·¥æ—¶: 10å°æ—¶

æ­¥éª¤:
1. ä¿®å¤File Service bug
   â””â”€ file_service/app/main.py
   â””â”€ å®šä¹‰SHARED_VOLUME_PATH = "/var/uploads"

2. å‰ç«¯å®ç°ä¸¤æ­¥ä¸Šä¼ 
   â””â”€ æ­¥éª¤1: HTTP POST /file_service/upload â†’ file_id
   â””â”€ æ­¥éª¤2: WebSocketå‘é€file_id

3. åç«¯æ¥æ”¶file_id
   â””â”€ report_orchestratoræ¥æ”¶file_id
   â””â”€ æ ¹æ®æ–‡ä»¶ç±»å‹è°ƒç”¨parser
   â””â”€ PDF â†’ llm_gateway
   â””â”€ Excel â†’ excel_parser
   â””â”€ Word â†’ word_parser

4. æµ‹è¯•éªŒè¯
   â””â”€ ä¸Šä¼ å„ç§æ ¼å¼æ–‡ä»¶
   â””â”€ éªŒè¯è§£ææ­£ç¡®
```

#### Week 2: WebSocketç¨³å®šæ€§ + è®¤è¯

**ä»»åŠ¡3: WebSocketæ”¹è¿›** (ä¼˜å…ˆçº§P0)
```yaml
ç›®æ ‡: è¿æ¥ç¨³å®šï¼Œæ¶ˆæ¯ä¸ä¸¢å¤±
å·¥æ—¶: 5å°æ—¶

æ­¥éª¤:
1. æ·»åŠ å¿ƒè·³æœºåˆ¶
   â””â”€ æ¯30ç§’å‘é€heartbeatæ¶ˆæ¯
   â””â”€ æ£€æµ‹è¿æ¥æ´»æ€§

2. æ¶ˆæ¯é˜Ÿåˆ—ç¼“å­˜
   â””â”€ å‘é€å¤±è´¥çš„æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—
   â””â”€ é‡è¿åé‡å‘

3. ä¼˜åŒ–å‰ç«¯é‡è¿
   â””â”€ æŒ‡æ•°é€€é¿ç­–ç•¥
   â””â”€ ç½‘ç»œæ£€æµ‹

4. æµ‹è¯•éªŒè¯
   â””â”€ æ¨¡æ‹Ÿç½‘ç»œæŠ–åŠ¨
   â””â”€ éªŒè¯æ¶ˆæ¯ä¸ä¸¢å¤±
```

**ä»»åŠ¡4: JWTè®¤è¯** (ä¼˜å…ˆçº§P1)
```yaml
ç›®æ ‡: å®‰å…¨çš„èº«ä»½éªŒè¯
å·¥æ—¶: 8å°æ—¶

æ­¥éª¤:
1. å®ç°JWTç”Ÿæˆå’ŒéªŒè¯
   â””â”€ user_service/app/auth.py
   â””â”€ create_access_token()
   â””â”€ verify_token()

2. æ·»åŠ ç™»å½•ç«¯ç‚¹
   â””â”€ POST /login
   â””â”€ è¿”å›access_token

3. ä¿æŠ¤APIç«¯ç‚¹
   â””â”€ WebSocket: é€šè¿‡queryä¼ token
   â””â”€ REST: é€šè¿‡Headerä¼ token

4. å‰ç«¯é›†æˆ
   â””â”€ ç™»å½•é¡µé¢
   â””â”€ Tokenå­˜å‚¨
   â””â”€ è¯·æ±‚æºå¸¦Token
```

### 5.2 Phase 2: æœåŠ¡è§£è€¦ (ç¬¬3-4å‘¨)

#### Week 3: API Gateway + é…ç½®ç®¡ç†

**ä»»åŠ¡5: Nginx Gateway** (ä¼˜å…ˆçº§P1)
```yaml
ç›®æ ‡: ç»Ÿä¸€APIå…¥å£
å·¥æ—¶: 6å°æ—¶

æ­¥éª¤:
1. åˆ›å»ºnginx.conf
   â””â”€ è·¯ç”±è§„åˆ™
   â””â”€ WebSocketæ”¯æŒ
   â””â”€ è´Ÿè½½å‡è¡¡

2. docker-composeé›†æˆ
   â””â”€ nginxæœåŠ¡
   â””â”€ ä¾èµ–å…¶ä»–æœåŠ¡

3. å‰ç«¯æ›´æ–°
   â””â”€ ç»Ÿä¸€API_URL
   â””â”€ ç§»é™¤ç¡¬ç¼–ç URL

4. æµ‹è¯•éªŒè¯
   â””â”€ æ‰€æœ‰è¯·æ±‚é€šè¿‡Gateway
   â””â”€ WebSocketæ­£å¸¸å·¥ä½œ
```

**ä»»åŠ¡6: é…ç½®ç®¡ç†** (ä¼˜å…ˆçº§P1)
```yaml
ç›®æ ‡: å»ç¡¬ç¼–ç ï¼Œç¯å¢ƒå˜é‡åŒ–
å·¥æ—¶: 4å°æ—¶

æ­¥éª¤:
1. åˆ›å»ºSettingsç±»
   â””â”€ pydantic-settings
   â””â”€ æ”¯æŒ.envæ–‡ä»¶

2. æ›¿æ¢ç¡¬ç¼–ç 
   â””â”€ æ‰€æœ‰æœåŠ¡URL
   â””â”€ æ‰€æœ‰APIå¯†é’¥
   â””â”€ æ‰€æœ‰é…ç½®å‚æ•°

3. docker-composeç¯å¢ƒå˜é‡
   â””â”€ æœåŠ¡é—´é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®

4. æ–‡æ¡£æ›´æ–°
   â””â”€ .env.example
   â””â”€ é…ç½®è¯´æ˜
```

#### Week 4: æ¶ˆæ¯é˜Ÿåˆ— + ç›‘æ§

**ä»»åŠ¡7: RabbitMQé›†æˆ** (ä¼˜å…ˆçº§P1)
```yaml
ç›®æ ‡: å¼‚æ­¥ä»»åŠ¡å¤„ç†
å·¥æ—¶: 12å°æ—¶

æ­¥éª¤:
1. å¯ç”¨RabbitMQ
   â””â”€ docker-composeå–æ¶ˆæ³¨é‡Š
   â””â”€ å¥åº·æ£€æŸ¥é…ç½®

2. åˆ›å»ºPublisher
   â””â”€ å‘å¸ƒä»»åŠ¡åˆ°é˜Ÿåˆ—
   â””â”€ tdd_queue, mdd_queue

3. åˆ›å»ºWorker
   â””â”€ è®¢é˜…é˜Ÿåˆ—
   â””â”€ å¤„ç†ä»»åŠ¡
   â””â”€ ä¿å­˜ç»“æœåˆ°Redis

4. æµ‹è¯•éªŒè¯
   â””â”€ ä»»åŠ¡å¼‚æ­¥å¤„ç†
   â””â”€ Workerå¯æ‰©å±•
```

**ä»»åŠ¡8: Prometheusç›‘æ§** (ä¼˜å…ˆçº§P2)
```yaml
ç›®æ ‡: æ€§èƒ½æŒ‡æ ‡æ”¶é›†
å·¥æ—¶: 6å°æ—¶

æ­¥éª¤:
1. æ·»åŠ prometheus-client
   â””â”€ Counter, Histogram, Gauge

2. å®šä¹‰å…³é”®æŒ‡æ ‡
   â””â”€ dd_analyses_total
   â””â”€ dd_analysis_duration
   â””â”€ active_sessions

3. docker-composeé›†æˆ
   â””â”€ prometheusæœåŠ¡
   â””â”€ grafanaæœåŠ¡

4. ä»ªè¡¨ç›˜é…ç½®
   â””â”€ Grafana dashboard
   â””â”€ å‘Šè­¦è§„åˆ™
```

### 5.3 å…³é”®è·¯å¾„

```
ç¬¬1å¤©: Redisé›†æˆ
  â””â”€ ä¼šè¯æŒä¹…åŒ–éªŒè¯ âœ“

ç¬¬2-3å¤©: æ–‡ä»¶ä¸Šä¼ ä¿®å¤
  â””â”€ ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡ âœ“

ç¬¬4-5å¤©: WebSocket + è®¤è¯
  â””â”€ ç¨³å®šæ€§æµ‹è¯• âœ“

ç¬¬6-7å¤©: API Gateway
  â””â”€ ç»Ÿä¸€å…¥å£éªŒè¯ âœ“

ç¬¬8-10å¤©: æ¶ˆæ¯é˜Ÿåˆ—
  â””â”€ å¼‚æ­¥å¤„ç†éªŒè¯ âœ“

ç¬¬11-14å¤©: ç›‘æ§ + æµ‹è¯•
  â””â”€ Phase 1å®Œæˆ âœ“
```

---

## ğŸ“ å…­ã€å…³é”®å†³ç­–è®°å½•

### å†³ç­–1: ä½¿ç”¨Redisè€ŒéPostgreSQLå­˜å‚¨ä¼šè¯

**ç†ç”±**:
- âœ… å¿«é€Ÿè¯»å†™ (å†…å­˜å­˜å‚¨)
- âœ… æ”¯æŒTTL (è‡ªåŠ¨è¿‡æœŸ)
- âœ… ç®€å•éƒ¨ç½² (å•å®¹å™¨)
- âœ… ä¼šè¯æ•°æ®å¤©ç„¶é€‚åˆKVå­˜å‚¨

**å¤‡é€‰æ–¹æ¡ˆ**: PostgreSQL
- âŒ è¿‡é‡ (éœ€è¦ORM, migrations)
- âŒ è¯»å†™è¾ƒæ…¢ (ç£ç›˜IO)
- âœ… æ”¯æŒå¤æ‚æŸ¥è¯¢ (å¦‚æœéœ€è¦)

**æœ€ç»ˆ**: Redisç”¨äºä¼šè¯ï¼ŒPostgreSQLä¿ç•™ç”¨äºæŠ¥å‘ŠæŒä¹…åŒ–

---

### å†³ç­–2: ä¸¤æ­¥æ–‡ä»¶ä¸Šä¼ è€ŒéWebSocket Base64

**ç†ç”±**:
- âœ… æ”¯æŒå¤§æ–‡ä»¶ (>100MB)
- âœ… è§£è€¦ä¸Šä¼ å’Œåˆ†æ
- âœ… å¯å¤ç”¨ParseræœåŠ¡
- âœ… å¯æ–­ç‚¹ç»­ä¼ 

**å¤‡é€‰æ–¹æ¡ˆ**: WebSocket + Base64
- âŒ æ–‡ä»¶å¤§å°å—é™
- âŒ å†…å­˜å ç”¨é«˜
- âœ… å®ç°ç®€å• (å½“å‰æ–¹æ¡ˆ)

**æœ€ç»ˆ**: ä¸¤æ­¥ä¸Šä¼ ï¼Œå…¼å®¹æ€§æ›´å¥½

---

### å†³ç­–3: Nginxä½œä¸ºAPI Gatewayè€ŒéKong

**ç†ç”±**:
- âœ… è½»é‡çº§
- âœ… é…ç½®ç®€å•
- âœ… è¶³å¤ŸåŠŸèƒ½ (è·¯ç”±ã€è´Ÿè½½å‡è¡¡)
- âœ… ç†Ÿæ‚‰åº¦é«˜

**å¤‡é€‰æ–¹æ¡ˆ**: Kong
- âŒ è¾ƒé‡ (éœ€è¦PostgreSQL)
- âŒ å­¦ä¹ æ›²çº¿é™¡
- âœ… åŠŸèƒ½æ›´ä¸°å¯Œ (æ’ä»¶ç”Ÿæ€)

**æœ€ç»ˆ**: Nginxæ»¡è¶³å½“å‰éœ€æ±‚ï¼ŒKongå¯åç»­å‡çº§

---

### å†³ç­–4: RabbitMQè€ŒéKafka

**ç†ç”±**:
- âœ… æ›´é€‚åˆä»»åŠ¡é˜Ÿåˆ—
- âœ… æ”¯æŒä»»åŠ¡ç¡®è®¤
- âœ… è½»é‡çº§éƒ¨ç½²
- âœ… ç®¡ç†ç•Œé¢å‹å¥½

**å¤‡é€‰æ–¹æ¡ˆ**: Kafka
- âŒ è¿‡é‡ (éœ€è¦Zookeeper)
- âœ… æ›´é«˜ååé‡
- âœ… æ›´å¥½çš„æŒä¹…åŒ–

**æœ€ç»ˆ**: RabbitMQé€‚åˆå½“å‰è§„æ¨¡

---

## ğŸ“– ä¸ƒã€å‚è€ƒèµ„æ–™

### æ¶æ„æ¨¡å¼
- [Microservices Pattern](https://microservices.io/patterns/index.html)
- [12-Factor App](https://12factor.net/)
- [Event-Driven Architecture](https://martinfowler.com/articles/201701-event-driven.html)

### æŠ€æœ¯æ ˆ
- [FastAPI Best Practices](https://github.com/zhanymkanov/fastapi-best-practices)
- [Redis Best Practices](https://redis.io/docs/manual/patterns/)
- [RabbitMQ Tutorials](https://www.rabbitmq.com/getstarted.html)
- [Nginx Documentation](https://nginx.org/en/docs/)

### å¯è§‚æµ‹æ€§
- [Prometheus Best Practices](https://prometheus.io/docs/practices/)
- [Jaeger Documentation](https://www.jaegertracing.io/docs/)
- [The Three Pillars of Observability](https://www.oreilly.com/library/view/distributed-systems-observability/9781492033431/)

---

## ğŸ å…«ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹

1. **ä»Šå¤©**:
   - âœ… æ¶æ„è“å›¾å®¡é˜…å®Œæˆ
   - åˆ›å»ºPhase 1è¯¦ç»†ä»»åŠ¡æ¸…å•
   - å‡†å¤‡Redisç¯å¢ƒ

2. **æ˜å¤©**:
   - å¼€å§‹ä»»åŠ¡1: Redisé›†æˆ
   - ç¼–å†™SessionStoreç±»
   - å•å…ƒæµ‹è¯•

3. **æœ¬å‘¨æœ«**:
   - å®ŒæˆRedisé›†æˆ
   - å®Œæˆæ–‡ä»¶ä¸Šä¼ ä¿®å¤
   - ç«¯åˆ°ç«¯æµ‹è¯•

### æˆåŠŸæŒ‡æ ‡

**Phase 1å®Œæˆæ ‡å‡†**:
- âœ… æœåŠ¡é‡å¯åä¼šè¯ä¸ä¸¢å¤±
- âœ… BPæ–‡ä»¶èƒ½æ­£ç¡®ä¸Šä¼ å’Œè§£æ
- âœ… WebSocketè¿æ¥ç¨³å®š
- âœ… JWTè®¤è¯å·¥ä½œæ­£å¸¸
- âœ… ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡

---

**æœ¬è“å›¾æè¿°äº†Magellanç³»ç»Ÿçš„å®Œæ•´æ¶æ„ç°çŠ¶ã€æ ¸å¿ƒé—®é¢˜å’Œæ”¹é€ æ–¹æ¡ˆã€‚å»ºè®®ç«‹å³å¼€å§‹Phase 1çš„å®æ–½ï¼Œ2å‘¨å†…å®ŒæˆåŸºç¡€ä¿®å¤ï¼Œä¸ºç³»ç»Ÿçš„é•¿æœŸç¨³å®šè¿è¥å¥ å®šåŸºç¡€ã€‚**

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-11-15
**è´Ÿè´£äºº**: ç³»ç»Ÿæ¶æ„å¸ˆ
**ä¸‹æ¬¡å®¡æŸ¥**: Phase 1å®Œæˆå (çº¦2å‘¨å)
