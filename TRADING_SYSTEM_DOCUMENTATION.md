# Magellan Trading System - å®Œæ•´æ¶æ„ä¸èƒ½åŠ›æ–‡æ¡£ v3.0

> **æ–‡æ¡£æ›´æ–°æ—¥æœŸ**: 2026-01-03
> **é€‚ç”¨ç‰ˆæœ¬**: dev åˆ†æ”¯ (LangGraph + ExecutorAgent å¢å¼ºç‰ˆ)

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [äº¤æ˜“ç³»ç»Ÿè¯¦è§£](#äº¤æ˜“ç³»ç»Ÿè¯¦è§£)
4. [è§¦å‘å™¨ç³»ç»Ÿ (TriggerAgent)](#è§¦å‘å™¨ç³»ç»Ÿ-triggeragent)
5. [æ‰§è¡Œç³»ç»Ÿ (ExecutorAgent)](#æ‰§è¡Œç³»ç»Ÿ-executoragent)
6. [LangGraph å·¥ä½œæµ](#langgraph-å·¥ä½œæµ)
7. [é‡æ„å˜æ›´è®°å½•](#é‡æ„å˜æ›´è®°å½•)
8. [æœªå®ç°ä¸ç§»é™¤çš„èƒ½åŠ›](#æœªå®ç°ä¸ç§»é™¤çš„èƒ½åŠ›)
9. [æ”¹è¿›å»ºè®®ä¸æœªæ¥è§„åˆ’](#æ”¹è¿›å»ºè®®ä¸æœªæ¥è§„åˆ’)
10. [å¿«é€Ÿå¼€å§‹æŒ‡å—](#å¿«é€Ÿå¼€å§‹æŒ‡å—)

---

## ç³»ç»Ÿæ¦‚è¿°

### é¡¹ç›®å®šä½

**Magellan** æ˜¯ä¸€ä¸ª AI é©±åŠ¨çš„åŠ å¯†è´§å¸äº¤æ˜“ç³»ç»Ÿï¼Œå…·æœ‰åŒé‡ç”¨é€”ï¼š

1. **æŠ•èµ„å°½è°ƒå¹³å°** - å¤šåœºæ™¯æŠ•èµ„åˆ†ææŠ¥å‘Šç”Ÿæˆ
2. **è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ** - å¤š Agent åä½œçš„ BTC/USDT æ°¸ç»­åˆçº¦äº¤æ˜“

### æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | æè¿° |
|------|------|
| **å¤š Agent åä½œ** | 7+ ä¸“ä¸šåˆ†æ Agent (æŠ€æœ¯é¢ã€åŸºæœ¬é¢ã€é“¾ä¸Šæ•°æ®ç­‰) |
| **æ™ºèƒ½è§¦å‘** | TriggerAgent ç›‘æ§å¸‚åœºï¼Œæ™ºèƒ½å†³å®šä½•æ—¶å¯åŠ¨åˆ†æ |
| **LangGraph ç¼–æ’** | åŸºäºçŠ¶æ€æœºçš„å·¥ä½œæµï¼Œæ”¯æŒæ¡ä»¶åˆ†æ”¯å’Œé”™è¯¯æ¢å¤ |
| **ä»“ä½ç®¡ç†** | æ”¯æŒåŠ ä»“ã€å‡ä»“ã€åå‘æ“ä½œçš„æ™ºèƒ½ä»“ä½ç®¡ç† |
| **é£é™©æ§åˆ¶** | å¤šå±‚å®‰å…¨æ£€æŸ¥ (å¯åŠ¨ä¿æŠ¤ã€æ­¢æŸéªŒè¯ã€çˆ†ä»“é£é™©) |

---

## æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Magellan Trading System v3.0                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                       Trigger Layer (è§¦å‘å±‚)                         â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚TriggerSchedulerâ”‚ â”‚ TriggerAgent â”‚ â”‚ NewsCrawler â”‚ â”‚TACalculatorâ”‚ â”‚    â”‚
â”‚  â”‚  â”‚  (å®šæ—¶æ£€æŸ¥)   â”‚ â”‚  (LLMåˆ†æ)   â”‚ â”‚  (æ–°é—»æŠ“å–) â”‚ â”‚ (æŠ€æœ¯æŒ‡æ ‡) â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                          â”‚                                          â”‚    â”‚
â”‚  â”‚                    TriggerLock (çŠ¶æ€æœº)                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚ (è§¦å‘æ—¶è°ƒç”¨)                           â”‚
â”‚                                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Orchestration Layer (ç¼–æ’å±‚)                      â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚  TradingGraph   â”‚â”€â”€â”‚     7 Nodes     â”‚â”€â”€â”‚   TradingState  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   (LangGraph)   â”‚  â”‚ (å·¥ä½œæµèŠ‚ç‚¹)     â”‚  â”‚   (çŠ¶æ€ç®¡ç†)    â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                        â”‚
â”‚                                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         Agent Layer (åˆ†æå±‚)                         â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ TA_Analyst  â”‚ â”‚ Fund_Analystâ”‚ â”‚Chain_Analystâ”‚ â”‚ Macro_Expertâ”‚  â”‚    â”‚
â”‚  â”‚  â”‚  (æŠ€æœ¯åˆ†æ) â”‚ â”‚  (èµ„é‡‘æµ)   â”‚ â”‚ (é“¾ä¸Šæ•°æ®)  â”‚ â”‚  (å®è§‚)     â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                        â”‚
â”‚                                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                       Execution Layer (æ‰§è¡Œå±‚)                       â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚                    ExecutorAgent                              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 7 Tools: open_long, open_short, close_position, hold,  â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚          add_to_long, add_to_short, reduce_position    â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Safety: _validate_stop_loss, _get_available_margin,    â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚         MIN_ADD_AMOUNT=10, SAFETY_BUFFER=50             â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                        â”‚
â”‚                                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        Trading Layer (äº¤æ˜“å±‚)                        â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚      PaperTrader         â”‚    â”‚       OKX API            â”‚      â”‚    â”‚
â”‚  â”‚  â”‚   (æ¨¡æ‹Ÿäº¤æ˜“/å›æµ‹)        â”‚    â”‚   (å®ç›˜/æ¨¡æ‹Ÿç›˜)          â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                        â”‚
â”‚                                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        Memory Layer (è®°å¿†å±‚)                         â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ ReflectionMemory â”‚ â”‚  AgentWeights    â”‚ â”‚ TradingDecision  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    (Redis)       â”‚ â”‚    (Redis)       â”‚ â”‚  Store (Redis)   â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
backend/services/report_orchestrator/app/core/trading/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ trading_meeting.py          # ä¸»å…¥å£ (å…¼å®¹æ—§ç‰ˆ + LangGraph)
â”œâ”€â”€ executor_agent.py           # â­ æ‰§è¡Œå™¨ Agent (7 å·¥å…· + å®‰å…¨é€»è¾‘)
â”œâ”€â”€ executor.py                 # æ—§ç‰ˆ TradeExecutor
â”‚
â”œâ”€â”€ trigger/                    # â­ è§¦å‘å™¨ç³»ç»Ÿ (æ–°å¢)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent.py               # TriggerAgent (LLM é©±åŠ¨)
â”‚   â”œâ”€â”€ scheduler.py           # TriggerScheduler (å®šæ—¶æ£€æŸ¥)
â”‚   â”œâ”€â”€ lock.py                # TriggerLock (çŠ¶æ€æœº)
â”‚   â”œâ”€â”€ news_crawler.py        # æ–°é—»æŠ“å–
â”‚   â”œâ”€â”€ ta_calculator.py       # æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
â”‚   â”œâ”€â”€ scorer.py              # è§„åˆ™è¯„åˆ†å™¨ (å¤‡ç”¨)
â”‚   â””â”€â”€ prompts.py             # LLM æç¤ºè¯
â”‚
â”œâ”€â”€ orchestration/             # â­ LangGraph ç¼–æ’
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ graph.py               # TradingGraph ä¸»å…¥å£
â”‚   â”œâ”€â”€ nodes.py               # 7 ä¸ªå·¥ä½œæµèŠ‚ç‚¹
â”‚   â””â”€â”€ state.py               # TradingState å®šä¹‰
â”‚
â”œâ”€â”€ domain/                    # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ unified_position.py    # ç»Ÿä¸€ä»“ä½æ¨¡å‹
â”‚   â””â”€â”€ account.py             # è´¦æˆ·ä¿¡æ¯
â”‚
â”œâ”€â”€ safety/                    # å®‰å…¨æ§åˆ¶
â”‚   â””â”€â”€ guards.py              # SafetyGuard
â”‚
â””â”€â”€ reflection/                # åæ€å­¦ä¹ 
    â””â”€â”€ engine.py              # ReflectionEngine
```

---

## äº¤æ˜“ç³»ç»Ÿè¯¦è§£

### äº¤æ˜“å†³ç­–æµç¨‹

```
å¸‚åœºå˜åŒ– â†’ TriggerAgent åˆ¤æ–­ â†’ è§¦å‘åˆ†æ?
                                   â”‚ YES
                                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         LangGraph Workflow               â”‚
        â”‚                                          â”‚
        â”‚  market_analysis_node                    â”‚
        â”‚         â†“                                â”‚
        â”‚  signal_generation_node (Agents æŠ•ç¥¨)   â”‚
        â”‚         â†“                                â”‚
        â”‚  risk_assessment_node (å®‰å…¨æ£€æŸ¥)         â”‚
        â”‚         â†“                                â”‚
        â”‚  consensus_node (è¾¾æˆå…±è¯†)               â”‚
        â”‚         â†“                                â”‚
        â”‚  execution_node â†’ ExecutorAgent         â”‚
        â”‚         â†“                                â”‚
        â”‚  reflection_node (è®°å½•åæ€)              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
            äº¤æ˜“ä¿¡å·ç”Ÿæˆ â†’ PaperTrader/OKX æ‰§è¡Œ
```

### Agent æŠ•ç¥¨æœºåˆ¶

æ¯ä¸ªåˆ†æ Agent è¿”å›æŠ•ç¥¨ç»“æœï¼š

```python
{
    "agent_id": "technical_analyst",
    "direction": "long",      # long/short/hold
    "confidence": 75,         # 0-100
    "key_factors": ["RSI oversold", "Golden cross"],
    "reasoning": "æŠ€æœ¯é¢çœ‹æ¶¨..."
}
```

å…±è¯†è®¡ç®—è§„åˆ™ï¼š

- åŠ æƒå¹³å‡å„ Agent æŠ•ç¥¨
- åŠ¨æ€æƒé‡åŸºäºå†å²å‡†ç¡®ç‡
- ä¿¡å¿ƒåº¦ä½äºé˜ˆå€¼åˆ™ HOLD

---

## è§¦å‘å™¨ç³»ç»Ÿ (TriggerAgent)

### è®¾è®¡ç›®æ ‡

é¿å…åœ¨æ— å˜åŒ–çš„å¸‚åœºä¸­é¢‘ç¹è°ƒç”¨ LLM åˆ†æï¼ŒèŠ‚çœ API æˆæœ¬ã€‚

### ç»„ä»¶è¯´æ˜

| ç»„ä»¶ | èŒè´£ |
|------|------|
| `TriggerScheduler` | æ¯ 5 åˆ†é’Ÿæ‰§è¡Œå®šæ—¶æ£€æŸ¥ |
| `TriggerAgent` | ä½¿ç”¨ LLM åˆ†ææ˜¯å¦åº”è¯¥è§¦å‘ä¸»åˆ†æ |
| `TriggerLock` | çŠ¶æ€æœºï¼Œé˜²æ­¢å¹¶å‘è§¦å‘å’Œä¸»åˆ†æå†²çª |
| `NewsCrawler` | æŠ“å–åŠ å¯†è´§å¸ç›¸å…³æ–°é—» |
| `TACalculator` | è®¡ç®— RSIã€MACDã€æˆäº¤é‡ç­‰æŠ€æœ¯æŒ‡æ ‡ |

### çŠ¶æ€æœº (TriggerLock)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  idle   â”‚ â† åˆå§‹çŠ¶æ€
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚ acquire() è§¦å‘æ£€æŸ¥
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚checking â”‚ â† TriggerAgent è¿è¡Œä¸­
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚ release_check()
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
    should_trigger   not_trigger    error
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚analyzingâ”‚    â”‚ cooldown â”‚    â”‚  idle   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚ (5 åˆ†é’Ÿåè¿‡æœŸ)
         â”‚              â–¼
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  idle   â”‚
   release()       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»“ä½æ„ŸçŸ¥èƒ½åŠ›

TriggerAgent ç°åœ¨å¯ä»¥æ„ŸçŸ¥å½“å‰ä»“ä½çŠ¶æ€ï¼š

```python
# TriggerContext æ–°å¢å­—æ®µ
has_position: bool = False
position_direction: str = "none"
position_pnl_percent: float = 0.0
position_size_usd: float = 0.0
```

è¿™ä½¿ TriggerAgent å¯ä»¥åšå‡ºä»“ä½ç›¸å…³å†³ç­–ï¼š

- æŒä»“æµ®äº >10%? â†’ å¯èƒ½éœ€è¦æ­¢æŸåˆ†æ
- æŒä»“æµ®ç›ˆ >15%? â†’ è€ƒè™‘æ˜¯å¦é”å®šåˆ©æ¶¦

---

## æ‰§è¡Œç³»ç»Ÿ (ExecutorAgent)

### 7 ä¸ªäº¤æ˜“å·¥å…·

| å·¥å…· | ç”¨é€” | ç›´æ¥è°ƒç”¨ |
|------|------|----------|
| `open_long` | å¼€å¤šä»“ (å«åå‘é€»è¾‘) | âœ… paper_trader.open_long() |
| `open_short` | å¼€ç©ºä»“ (å«åå‘é€»è¾‘) | âœ… paper_trader.open_short() |
| `hold` | è§‚æœ›ä¸æ“ä½œ | æ— äº¤æ˜“è°ƒç”¨ |
| `close_position` | å®Œå…¨å¹³ä»“ | âœ… paper_trader.close_position() |
| `add_to_long` | åŠ å¤šä»“ | âœ… paper_trader.open_long() (å°ä»“) |
| `add_to_short` | åŠ ç©ºä»“ | âœ… paper_trader.open_short() (å°ä»“) |
| `reduce_position` | éƒ¨åˆ†å¹³ä»“ | âœ… paper_trader.close_position(partial) |

### åœºæ™¯é€»è¾‘ (open_long ç¤ºä¾‹)

```
LLM å†³å®š LONG
     â”‚
     â–¼
å½“å‰ä»“ä½æ£€æŸ¥
     â”‚
     â”œâ”€â”€â”€ å·²æŒæœ‰ LONG â”€â”€â†’ åŠ ä»“æˆ–ç»´æŒ
     â”‚
     â”œâ”€â”€â”€ å·²æŒæœ‰ SHORT â”€â”€â†’ å…ˆå¹³ç©ºï¼Œå†å¼€å¤š (åå‘æ“ä½œ)
     â”‚
     â””â”€â”€â”€ æ— ä»“ä½ â”€â”€â†’ æ–°å¼€å¤šä»“
```

### å®‰å…¨æœºåˆ¶

```python
# å®‰å…¨å¸¸é‡
MIN_ADD_AMOUNT = 10.0   # æœ€å°åŠ ä»“é‡‘é¢ (USDT)
SAFETY_BUFFER = 50.0    # ä¿è¯é‡‘å®‰å…¨ç¼“å†² (USDT)

# å®‰å…¨æ–¹æ³•
_get_position_info()      # è·å–å½“å‰ä»“ä½
_get_available_margin()   # çœŸå®å¯ç”¨ä¿è¯é‡‘ (å«æœªå®ç°ç›ˆäº)
_validate_stop_loss()     # éªŒè¯æ­¢æŸä»·æ ¼ä¸ä½äºçˆ†ä»“ä»·æ ¼
```

### æ­¢æŸéªŒè¯é€»è¾‘

```python
def _validate_stop_loss(direction, entry_price, sl_price, leverage, margin):
    """
    ç¡®ä¿æ­¢æŸè§¦å‘åœ¨çˆ†ä»“ä¹‹å‰
    çˆ†ä»“æ¡ä»¶: äºæŸè¾¾åˆ°ä¿è¯é‡‘çš„ 80%
    """
    liquidation_loss = margin * 0.8
    size = (margin * leverage) / entry_price
    
    if direction == "long":
        liquidation_price = entry_price - (liquidation_loss / size)
        if sl_price <= liquidation_price:
            safe_sl = liquidation_price * 1.05  # 5% å®‰å…¨è¾¹é™…
            return False, f"SL below liquidation", safe_sl
    # ...
```

---

## LangGraph å·¥ä½œæµ

### 7 ä¸ªèŠ‚ç‚¹

```python
workflow_nodes = [
    "market_analysis_node",    # å¸‚åœºæ•°æ®æ”¶é›†
    "signal_generation_node",  # Agent æŠ•ç¥¨
    "risk_assessment_node",    # é£é™©è¯„ä¼°
    "consensus_node",          # å…±è¯†è¾¾æˆ
    "execution_node",          # æ‰§è¡Œäº¤æ˜“ (ExecutorAgent)
    "reflection_node",         # åæ€è®°å½•
    "react_fallback_node"      # é”™è¯¯æ¢å¤
]
```

### æ¡ä»¶è¾¹

```python
# æ˜¯å¦æ‰§è¡Œäº¤æ˜“
def should_execute_or_fallback(state):
    if state.get("error"):
        return "react_fallback"
    return "execution"

# æ˜¯å¦è¿›è¡Œåæ€
def should_reflect(state):
    signal = state.get("final_signal", {})
    if signal.get("direction") in ["long", "short"]:
        return "reflection"
    return END
```

### TradingState ç»“æ„

```python
class TradingState(TypedDict):
    # è¾“å…¥
    position_context: Dict[str, Any]
    market_snapshot: Dict[str, Any]
    
    # ä¸­é—´çŠ¶æ€
    agent_votes: List[Dict]
    leader_summary: str
    risk_assessment: Dict
    
    # è¾“å‡º
    final_signal: Dict
    execution_success: bool
    
    # å…ƒæ•°æ®
    current_node: str
    completed_nodes: List[str]
    node_timings: Dict[str, float]
    error: Optional[str]
```

---

## é‡æ„å˜æ›´è®°å½•

### v2.0 â†’ v3.0 ä¸»è¦å˜æ›´

| å˜æ›´é¡¹ | v2.0 (æ—§) | v3.0 (æ–°) |
|--------|----------|----------|
| **ç¼–æ’æ–¹å¼** | trading_meeting.py å•æ–‡ä»¶ | LangGraph å·¥ä½œæµ |
| **æ‰§è¡Œå™¨** | TradeExecutor (ä¿¡å·ç”Ÿæˆ) | ExecutorAgent (ç›´æ¥äº¤æ˜“) |
| **è§¦å‘å™¨** | å®šæ—¶è½®è¯¢ | TriggerAgent + LLM åˆ†æ |
| **ä»“ä½ç®¡ç†** | open_long_tool å†…éƒ¨åœºæ™¯ | 7 ä¸ªç‹¬ç«‹å·¥å…· |
| **ä»£ç è¡Œæ•°** | ~4,000 è¡Œå•æ–‡ä»¶ | æ¨¡å—åŒ–åˆ†å¸ƒ |

### ç§»é™¤çš„èƒ½åŠ›

| èƒ½åŠ› | åŸå®ç° | çŠ¶æ€ | æ›¿ä»£æ–¹æ¡ˆ |
|------|--------|------|----------|
| **Embedding æœç´¢** | Chroma å‘é‡åº“ | âŒ å·²ç§»é™¤ | ç›´æ¥ API æœç´¢ |
| **RAG çŸ¥è¯†åº“** | embedding + æ£€ç´¢ | âŒ å·²ç§»é™¤ | æ—  |
| **è¯­ä¹‰ç›¸ä¼¼æœç´¢** | å‘é‡ç›¸ä¼¼åº¦ | âŒ å·²ç§»é™¤ | å…³é”®è¯åŒ¹é… |

### ä¿ç•™çš„èƒ½åŠ›

| èƒ½åŠ› | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| æ­¢æŸéªŒè¯ | âœ… å®Œæ•´ | `_validate_stop_loss()` |
| ä¿è¯é‡‘ç®¡ç† | âœ… å®Œæ•´ | `_get_available_margin()` å«æœªå®ç°ç›ˆäº |
| åå‘æ“ä½œ | âœ… å®Œæ•´ | open_long/short è‡ªåŠ¨å¤„ç† |
| åŠ ä»“å‡ä»“ | âœ… å®Œæ•´ | add_to_long/short, reduce_position |
| Agent æƒé‡ | âœ… å®Œæ•´ | åŠ¨æ€è°ƒæ•´ |
| åæ€å­¦ä¹  | âœ… å®Œæ•´ | ReflectionEngine |

---

## æœªå®ç°ä¸ç§»é™¤çš„èƒ½åŠ›

### 1. Embedding/RAG æœç´¢ (å·²ç§»é™¤)

**åŸå› **: ç»´æŠ¤æˆæœ¬é«˜ï¼Œæ•ˆæœä¸æ˜æ˜¾

**å½±å“**:

- æ— æ³•è¿›è¡Œè¯­ä¹‰ç›¸ä¼¼æœç´¢
- å†å²åˆ†ææŠ¥å‘Šæ— æ³•ä½œä¸ºçŸ¥è¯†åº“

**æ›¿ä»£æ–¹æ¡ˆ**:

- ä½¿ç”¨ Perplexity API å®æ—¶æœç´¢
- å…³é”®è¯åŒ¹é…å†å²è®°å½•

### 2. å¤šäº¤æ˜“å¯¹æ”¯æŒ (æœªå®ç°)

**å½“å‰**: ä»…æ”¯æŒ BTC-USDT-SWAP

**æ‰©å±•æ–¹å‘**:

- æ·»åŠ  ETH-USDT-SWAP
- symbol å‚æ•°åŒ–

### 3. è‡ªåŠ¨æ­¢ç›ˆæ­¢æŸè°ƒæ•´ (éƒ¨åˆ†å®ç°)

**å½“å‰**: ä½¿ç”¨å›ºå®šç™¾åˆ†æ¯” (TP 8%, SL 3%)

**æ”¹è¿›æ–¹å‘**:

- åŸºäº ATR åŠ¨æ€è®¡ç®—
- ç§»åŠ¨æ­¢æŸ (trailing stop)

---

## æ”¹è¿›å»ºè®®ä¸æœªæ¥è§„åˆ’

### çŸ­æœŸ (1-2 å‘¨)

1. **é›†æˆæµ‹è¯•** - ç«¯åˆ°ç«¯æµ‹è¯• LangGraph å·¥ä½œæµ
2. **æ—¥å¿—å¢å¼º** - æ·»åŠ ç»“æ„åŒ–æ—¥å¿—ä¾¿äºè¿½è¸ª
3. **é”™è¯¯æ¢å¤** - react_fallback_node å®Œå–„

### ä¸­æœŸ (1-2 æœˆ)

1. **ATR åŠ¨æ€æ­¢æŸ** - åŸºäºæ³¢åŠ¨ç‡è°ƒæ•´æ­¢æŸè·ç¦»
2. **å¤šæ—¶é—´æ¡†æ¶åˆ†æ** - 1h + 4h + 1d ç»¼åˆåˆ¤æ–­
3. **äº‹ä»¶é©±åŠ¨è§¦å‘** - ç›‘å¬é“¾ä¸Šå¤§é¢è½¬è´¦

### é•¿æœŸ (3-6 æœˆ)

1. **å¤šäº¤æ˜“å¯¹æ”¯æŒ** - ETH, BNB ç­‰ä¸»æµå¸
2. **ç­–ç•¥æ¡†æ¶** - å¯é…ç½®çš„äº¤æ˜“ç­–ç•¥
3. **å›æµ‹ç³»ç»Ÿ** - å†å²æ•°æ®å›æµ‹éªŒè¯
4. **é£æ§ä»ªè¡¨æ¿** - å¯è§†åŒ–ç›‘æ§

---

## å¿«é€Ÿå¼€å§‹æŒ‡å—

### æœ¬åœ°å¼€å‘

```bash
# 1. å¯åŠ¨ä¾èµ–æœåŠ¡
docker-compose up -d redis postgres llm_gateway

# 2. è¿è¡Œäº¤æ˜“æœåŠ¡
cd backend/services/report_orchestrator
uvicorn app.main:app --reload --port 8000

# 3. å¯åŠ¨å‰ç«¯ (å¯é€‰)
cd frontend
npm run dev
```

### é…ç½®æ–‡ä»¶

```bash
# .env å…³é”®é…ç½®
OKX_API_KEY=xxx
OKX_SECRET_KEY=xxx
OKX_PASSPHRASE=xxx
OKX_IS_DEMO=true          # true=æ¨¡æ‹Ÿç›˜, false=å®ç›˜

TRIGGER_CHECK_INTERVAL=300        # è§¦å‘å™¨æ£€æŸ¥é—´éš” (ç§’)
TRIGGER_CONFIDENCE_THRESHOLD=60   # è§¦å‘å™¨ä¿¡å¿ƒé˜ˆå€¼

REDIS_HOST=localhost
LLM_GATEWAY_URL=http://localhost:8003
```

### API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/trading/status` | GET | è·å–ç³»ç»ŸçŠ¶æ€ |
| `/api/trading/start` | POST | å¯åŠ¨äº¤æ˜“ç³»ç»Ÿ |
| `/api/trading/stop` | POST | åœæ­¢äº¤æ˜“ç³»ç»Ÿ |
| `/api/trading/history` | GET | è·å–äº¤æ˜“å†å² |
| `/ws/trading/{session_id}` | WS | å®æ—¶äº¤æ˜“æ¨é€ |

---

## é™„å½•

### A. ä»£ç è§„èŒƒ

- æ‰€æœ‰äº¤æ˜“ç›¸å…³ä»£ç ä½¿ç”¨ `async/await`
- æ—¥å¿—æ ¼å¼: `[ModuleName] emoji æ¶ˆæ¯`
- é”™è¯¯å¤„ç†: æ•è·å¹¶è®°å½•ï¼Œè¿”å›é»˜è®¤å®‰å…¨å€¼

### B. ç›¸å…³æ–‡æ¡£

- [ARCHITECTURE.md](/docs/refactoring/ARCHITECTURE.md) - æ¨¡å—æ¶æ„
- [DEPLOY.md](/docs/refactoring/DEPLOY.md) - éƒ¨ç½²æŒ‡å—
- [REFACTORING_PLAN.md](/docs/refactoring/REFACTORING_PLAN.md) - é‡æ„è®¡åˆ’

### C. è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»é¡¹ç›®ç»´æŠ¤è€…æˆ–æäº¤ Issueã€‚

---

*æœ€åæ›´æ–°: 2026-01-03 by Antigravity AI Assistant*
